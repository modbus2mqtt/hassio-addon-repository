import{a as Ri,b as Gi,f as Oi,g as le,h as ce,i as Li,j as me,k as Ai,l as xe,m as ot,n as qi,o as Ui}from"./chunk-PSZ523TA.js";import{$ as yt,$a as Tt,Ac as $e,Ad as W,Bb as di,Ca as oi,Cc as H,Cd as w,D as ue,Da as ai,Db as We,Dc as Ke,Dd as j,Ea as l,Eb as ui,Ed as ie,F as q,Fa as s,Fd as Pi,G as Qt,Ga as k,Gc as z,Gd as ne,H as Ie,Ha as P,Hc as be,Hd as re,Ia as V,Id as Xe,J as Jt,Jb as ke,Jd as Vi,Ka as C,Kd as oe,M as vt,Mb as je,Na as St,Nd as ae,O as _e,Oa as h,Ob as Re,Od as Mi,Pb as hi,Pd as Ni,Q as E,Qa as f,Qd as se,R as J,Rc as yi,Rd as $,S as g,Sb as Pt,Sd as K,T as _,Tc as bi,Td as et,Ua as Et,Ub as fi,Ud as tt,Va as xt,Vd as it,Wa as wt,Wb as X,X as Xt,Xa as ze,Xd as nt,Ya as d,Yc as Ce,Yd as ki,Z as T,Za as M,Zc as Ci,Zd as Z,_ as Ue,_a as x,_c as Se,_d as rt,ab as Dt,ac as gi,ad as Ze,bb as ve,bc as _i,cb as L,cd as A,da as ei,dd as Mt,e as ge,eb as si,ec as vi,ed as ee,f as gt,fa as Be,fb as li,fc as Vt,fd as D,g as b,gb as ci,gd as Ee,h as $t,ha as ti,hb as Me,hd as Si,i as Kt,ia as c,ib as Ne,id as Ye,ja as F,jb as mi,jd as Ei,kb as Ft,kd as Qe,la as ii,lb as ye,m as de,mb as U,md as xi,na as ni,nb as B,nd as Je,oa as bt,od as Nt,pa as G,pd as wi,ra as Pe,rd as Ge,sa as He,sb as pi,sd as Ti,t as Zt,ta as Ct,u as qe,ua as y,ub as It,ud as Di,va as ri,vd as Fi,w as _t,wa as p,wd as Ii,xd as Q,y as Yt,ya as Ve,yd as te}from"./chunk-XATZT6MD.js";function an(o){let n=o.cloneNode(!0),e=n.querySelectorAll("[id]"),i=o.nodeName.toLowerCase();n.removeAttribute("id");for(let t=0;t<e.length;t++)e[t].removeAttribute("id");return i==="canvas"?zi(o,n):(i==="input"||i==="select"||i==="textarea")&&Hi(o,n),Bi("canvas",o,n,zi),Bi("input, textarea, select",o,n,Hi),n;}function Bi(o,n,e,i){let t=n.querySelectorAll(o);if(t.length){let r=e.querySelectorAll(o);for(let a=0;a<t.length;a++)i(t[a],r[a]);}}var Dn=0;function Hi(o,n){n.type!=="file"&&(n.value=o.value),n.type==="radio"&&n.name&&(n.name=`mat-clone-${n.name}-${Dn++}`);}function zi(o,n){let e=n.getContext("2d");if(e)try{e.drawImage(o,0,0);}catch{}}function qt(o){let n=o.getBoundingClientRect();return{top:n.top,right:n.right,bottom:n.bottom,left:n.left,width:n.width,height:n.height,x:n.x,y:n.y};}function Rt(o,n,e){let{top:i,bottom:t,left:r,right:a}=o;return e>=i&&e<=t&&n>=r&&n<=a;}function Le(o,n,e){o.top+=n,o.bottom=o.top+o.height,o.left+=e,o.right=o.left+o.width;}function Wi(o,n,e,i){let{top:t,right:r,bottom:a,left:m,width:u,height:v}=o,S=u*n,N=v*n;return i>t-N&&i<a+N&&e>m-S&&e<r+S;}var lt=class{_document;positions=new Map();constructor(n){this._document=n;}clear(){this.positions.clear();}cache(n){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),n.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:qt(e)});});}handleScroll(n){let e=Re(n),i=this.positions.get(e);if(!i)return null;let t=i.scrollPosition,r,a;if(e===this._document){let v=this.getViewportScrollPosition();r=v.top,a=v.left;}else r=e.scrollTop,a=e.scrollLeft;let m=t.top-r,u=t.left-a;return this.positions.forEach((v,S)=>{v.clientRect&&e!==S&&e.contains(S)&&Le(v.clientRect,m,u);}),t.top=r,t.left=a,{top:m,left:u};}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX};}};function sn(o,n){let e=o.rootNodes;if(e.length===1&&e[0].nodeType===n.ELEMENT_NODE)return e[0];let i=n.createElement("div");return e.forEach(t=>i.appendChild(t)),i;}function Ut(o,n,e){for(let i in n)if(n.hasOwnProperty(i)){let t=n[i];t?o.setProperty(i,t,e?.has(i)?"important":""):o.removeProperty(i);}return o;}function we(o,n){let e=n?"":"none";Ut(o.style,{"touch-action":n?"":"none","-webkit-user-drag":n?"":"none","-webkit-tap-highlight-color":n?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e});}function ji(o,n,e){Ut(o.style,{position:n?"":"fixed",top:n?"":"0",opacity:n?"":"0",left:n?"":"-999em"},e);}function ct(o,n){return n&&n!="none"?o+" "+n:o;}function $i(o,n){o.style.width=`${n.width}px`,o.style.height=`${n.height}px`,o.style.transform=mt(n.left,n.top);}function mt(o,n){return`translate3d(${Math.round(o)}px, ${Math.round(n)}px, 0)`;}function Ki(o){let n=o.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(o)*n;}function Fn(o){let n=getComputedStyle(o),e=kt(n,"transition-property"),i=e.find(m=>m==="transform"||m==="all");if(!i)return 0;let t=e.indexOf(i),r=kt(n,"transition-duration"),a=kt(n,"transition-delay");return Ki(r[t])+Ki(a[t]);}function kt(o,n){return o.getPropertyValue(n).split(",").map(i=>i.trim());}var In=new Set(["position"]),Gt=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview;}constructor(n,e,i,t,r,a,m,u,v,S){this._document=n,this._rootElement=e,this._direction=i,this._initialDomRect=t,this._previewTemplate=r,this._previewClass=a,this._pickupPositionOnPage=m,this._initialTransform=u,this._zIndex=v,this._renderer=S;}attach(n){this._preview=this._createPreview(),n.appendChild(this._preview),Zi(this._preview)&&this._preview.showPopover();}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null;}setTransform(n){this._preview.style.transform=n;}getBoundingClientRect(){return this._preview.getBoundingClientRect();}addClass(n){this._preview.classList.add(n);}getTransitionDuration(){return Fn(this._preview);}addEventListener(n,e){return this._renderer.listen(this._preview,n,e);}_createPreview(){let n=this._previewTemplate,e=this._previewClass,i=n?n.template:null,t;if(i&&n){let r=n.matchSize?this._initialDomRect:null,a=n.viewContainer.createEmbeddedView(i,n.context);a.detectChanges(),t=sn(a,this._document),this._previewEmbeddedView=a,n.matchSize?$i(t,r):t.style.transform=mt(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y);}else t=an(this._rootElement),$i(t,this._initialDomRect),this._initialTransform&&(t.style.transform=this._initialTransform);return Ut(t.style,{"pointer-events":"none",margin:Zi(t)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},In),we(t,!1),t.classList.add("cdk-drag-preview"),t.setAttribute("popover","manual"),t.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(r=>t.classList.add(r)):t.classList.add(e)),t;}};function Zi(o){return"showPopover"in o;}var Yi=ke({passive:!0}),at=ke({passive:!1}),Qi=ke({passive:!1,capture:!0}),Pn=800,Ji=new Set(["position"]),Ot=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=bt(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new b();_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=ge.EMPTY;_pointerUpSubscription=ge.EMPTY;_scrollSubscription=ge.EMPTY;_resizeSubscription=ge.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set();_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled);}set disabled(n){n!==this._disabled&&(this._disabled=n,this._toggleNativeDragInteractions(),this._handles.forEach(e=>we(e,n)));}_disabled=!1;beforeStarted=new b();started=new b();released=new b();ended=new b();entered=new b();exited=new b();dropped=new b();moved=this._moveEvents;data;constrainPosition;constructor(n,e,i,t,r,a,m){this._config=e,this._document=i,this._ngZone=t,this._viewportRuler=r,this._dragDropRegistry=a,this._renderer=m,this.withRootElement(n).withParent(e.parentDragRef||null),this._parentPositions=new lt(i),a.registerDragItem(this);}getPlaceholderElement(){return this._placeholder;}getRootElement(){return this._rootElement;}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement();}withHandles(n){this._handles=n.map(i=>X(i)),this._handles.forEach(i=>we(i,this.disabled)),this._toggleNativeDragInteractions();let e=new Set();return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&e.add(i);}),this._disabledHandles=e,this;}withPreviewTemplate(n){return this._previewTemplate=n,this;}withPlaceholderTemplate(n){return this._placeholderTemplate=n,this;}withRootElement(n){let e=X(n);return e!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{e.addEventListener("mousedown",this._pointerDown,at),e.addEventListener("touchstart",this._pointerDown,Yi),e.addEventListener("dragstart",this._nativeDragStart,at);}),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this;}withBoundaryElement(n){return this._boundaryElement=n?X(n):null,this._resizeSubscription.unsubscribe(),n&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this;}withParent(n){return this._parentDragRef=n,this;}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null;}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this);}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0};}disableHandle(n){!this._disabledHandles.has(n)&&this._handles.indexOf(n)>-1&&(this._disabledHandles.add(n),we(n,!0));}enableHandle(n){this._disabledHandles.has(n)&&(this._disabledHandles.delete(n),we(n,this.disabled));}withDirection(n){return this._direction=n,this;}_withDropContainer(n){this._dropContainer=n;}getFreeDragPosition(){let n=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:n.x,y:n.y};}setFreeDragPosition(n){return this._activeTransform={x:0,y:0},this._passiveTransform.x=n.x,this._passiveTransform.y=n.y,this._dropContainer||this._applyRootElementTransform(n.x,n.y),this;}withPreviewContainer(n){return this._previewContainer=n,this;}_sortFromLastPointerPosition(){let n=this._lastKnownPointerPosition;n&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(n),n);}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._getShadowRoot()?.removeEventListener("selectstart",en,Qi);}_destroyPreview(){this._preview?.destroy(),this._preview=null;}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null;}_pointerDown=n=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(n);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,n);}else this.disabled||this._initializeDragSequence(this._rootElement,n);};_pointerMove=n=>{let e=this._getPointerPositionOnPage(n);if(!this._hasStartedDragging()){let t=Math.abs(e.x-this._pickupPositionOnPage.x),r=Math.abs(e.y-this._pickupPositionOnPage.y);if(t+r>=this._config.dragStartThreshold){let m=Date.now()>=this._dragStartTime+this._getDragStartDelay(n),u=this._dropContainer;if(!m){this._endDragSequence(n);return;}(!u||!u.isDragging()&&!u.isReceiving())&&(n.cancelable&&n.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(n)));}return;}n.cancelable&&n.preventDefault();let i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{let t=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,r=this._activeTransform;r.x=i.x-t.x+this._passiveTransform.x,r.y=i.y-t.y+this._passiveTransform.y,this._applyRootElementTransform(r.x,r.y);}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:n,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta});});};_pointerUp=n=>{this._endDragSequence(n);};_endDragSequence(n){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:n}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(n),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this);});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(n);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:n});}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this);}}_startDragSequence(n){Oe(n)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),i=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{e.addEventListener("selectstart",en,Qi);}),i){let t=this._rootElement,r=t.parentNode,a=this._placeholder=this._createPlaceholderElement(),m=this._anchor=this._anchor||this._document.createComment("");r.insertBefore(m,t),this._initialTransform=t.style.transform||"",this._preview=new Gt(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(r,e)),ji(t,!1,Ji),this._document.body.appendChild(r.replaceChild(a,t)),this.started.next({source:this,event:n}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this);}else this.started.next({source:this,event:n}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[]);}_initializeDragSequence(n,e){this._parentDragRef&&e.stopPropagation();let i=this.isDragging(),t=Oe(e),r=!t&&e.button!==0,a=this._rootElement,m=Re(e),u=!t&&this._lastTouchEventTime&&this._lastTouchEventTime+Pn>Date.now(),v=t?_i(e):gi(e);if(m&&m.draggable&&e.type==="mousedown"&&e.preventDefault(),i||r||u||v)return;if(this._handles.length){let Y=a.style;this._rootElementTapHighlight=Y.webkitTapHighlightColor||"",Y.webkitTapHighlightColor="transparent";}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(Y=>this._updateOnScroll(Y)),this._boundaryElement&&(this._boundaryRect=qt(this._boundaryElement));let S=this._previewTemplate;this._pickupPositionInElement=S&&S.template&&!S.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,n,e);let N=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:N.x,y:N.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e);}_cleanupDragArtifacts(n){ji(this._rootElement,!0,Ji),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,i=e.getItemIndex(this),t=this._getPointerPositionOnPage(n),r=this._getDragDistance(t),a=e._isOverContainer(t.x,t.y);this.ended.next({source:this,distance:r,dropPoint:t,event:n}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:a,distance:r,dropPoint:t,event:n}),e.drop(this,i,this._initialIndex,this._initialContainer,a,r,t,n),this._dropContainer=this._initialContainer;});}_updateActiveDropContainer({x:n,y:e},{x:i,y:t}){let r=this._initialContainer._getSiblingContainerFromPosition(this,n,e);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(n,e)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=r,this._dropContainer.enter(this,n,e,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)});}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,t),this._dropContainer._sortItem(this,n,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(n,e):this._applyPreviewTransform(n-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y));}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let n=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(n.left,n.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let t=m=>{(!m||this._preview&&Re(m)===this._preview.element&&m.propertyName==="transform")&&(a(),i(),clearTimeout(r));},r=setTimeout(t,e*1.5),a=this._preview.addEventListener("transitionend",t);}));}_createPlaceholderElement(){let n=this._placeholderTemplate,e=n?n.template:null,i;return e?(this._placeholderRef=n.viewContainer.createEmbeddedView(e,n.context),this._placeholderRef.detectChanges(),i=sn(this._placeholderRef,this._document)):i=an(this._rootElement),i.style.pointerEvents="none",i.classList.add("cdk-drag-placeholder"),i;}_getPointerPositionInElement(n,e,i){let t=e===this._rootElement?null:e,r=t?t.getBoundingClientRect():n,a=Oe(i)?i.targetTouches[0]:i,m=this._getViewportScrollPosition(),u=a.pageX-r.left-m.left,v=a.pageY-r.top-m.top;return{x:r.left-n.left+u,y:r.top-n.top+v};}_getPointerPositionOnPage(n){let e=this._getViewportScrollPosition(),i=Oe(n)?n.touches[0]||n.changedTouches[0]||{pageX:0,pageY:0}:n,t=i.pageX-e.left,r=i.pageY-e.top;if(this._ownerSVGElement){let a=this._ownerSVGElement.getScreenCTM();if(a){let m=this._ownerSVGElement.createSVGPoint();return m.x=t,m.y=r,m.matrixTransform(a.inverse());}}return{x:t,y:r};}_getConstrainedPointerPosition(n){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:t}=this.constrainPosition?this.constrainPosition(n,this,this._initialDomRect,this._pickupPositionInElement):n;if(this.lockAxis==="x"||e==="x"?t=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:a}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,m=this._boundaryRect,{width:u,height:v}=this._getPreviewRect(),S=m.top+a,N=m.bottom-(v-a),Y=m.left+r,ht=m.right-(u-r);i=Xi(i,Y,ht),t=Xi(t,S,N);}return{x:i,y:t};}_updatePointerDirectionDelta(n){let{x:e,y:i}=n,t=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,a=Math.abs(e-r.x),m=Math.abs(i-r.y);return a>this._config.pointerDirectionChangeThreshold&&(t.x=e>r.x?1:-1,r.x=e),m>this._config.pointerDirectionChangeThreshold&&(t.y=i>r.y?1:-1,r.y=i),t;}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let n=this._handles.length>0||!this.isDragging();n!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=n,we(this._rootElement,n));}_removeRootElementListeners(n){n.removeEventListener("mousedown",this._pointerDown,at),n.removeEventListener("touchstart",this._pointerDown,Yi),n.removeEventListener("dragstart",this._nativeDragStart,at);}_applyRootElementTransform(n,e){let i=1/this.scale,t=mt(n*i,e*i),r=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=r.transform&&r.transform!="none"?r.transform:""),r.transform=ct(t,this._initialTransform);}_applyPreviewTransform(n,e){let i=this._previewTemplate?.template?void 0:this._initialTransform,t=mt(n,e);this._preview.setTransform(ct(t,i));}_getDragDistance(n){let e=this._pickupPositionOnPage;return e?{x:n.x-e.x,y:n.y-e.y}:{x:0,y:0};}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear();}_containInsideBoundaryOnResize(){let{x:n,y:e}=this._passiveTransform;if(n===0&&e===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),t=this._boundaryElement.getBoundingClientRect();if(t.width===0&&t.height===0||i.width===0&&i.height===0)return;let r=t.left-i.left,a=i.right-t.right,m=t.top-i.top,u=i.bottom-t.bottom;t.width>i.width?(r>0&&(n+=r),a>0&&(n-=a)):n=0,t.height>i.height?(m>0&&(e+=m),u>0&&(e-=u)):e=0,(n!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:n});}_getDragStartDelay(n){let e=this.dragStartDelay;return typeof e=="number"?e:Oe(n)?e.touch:e?e.mouse:0;}_updateOnScroll(n){let e=this._parentPositions.handleScroll(n);if(e){let i=Re(n);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&Le(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y));}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition();}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=je(this._rootElement)),this._cachedShadowRoot;}_getPreviewInsertionPoint(n,e){let i=this._previewContainer||"global";if(i==="parent")return n;if(i==="global"){let t=this._document;return e||t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement||t.body;}return X(i);}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect;}_nativeDragStart=n=>{if(this._handles.length){let e=this._getTargetHandle(n);e&&!this._disabledHandles.has(e)&&!this.disabled&&n.preventDefault();}else this.disabled||n.preventDefault();};_getTargetHandle(n){return this._handles.find(e=>n.target&&(n.target===e||e.contains(n.target)));}};function Xi(o,n,e){return Math.max(n,Math.min(e,o));}function Oe(o){return o.type[0]==="t";}function en(o){o.preventDefault();}function De(o,n,e){let i=tn(n,o.length-1),t=tn(e,o.length-1);if(i===t)return;let r=o[i],a=t<i?-1:1;for(let m=i;m!==t;m+=a)o[m]=o[m+a];o[t]=r;}function tn(o,n){return Math.max(0,Math.min(n,o));}var pt=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(n){this._dragDropRegistry=n;}_previousSwap={drag:null,delta:0,overlaps:!1};start(n){this.withItems(n);}sort(n,e,i,t){let r=this._itemPositions,a=this._getItemIndexFromPointerPosition(n,e,i,t);if(a===-1&&r.length>0)return null;let m=this.orientation==="horizontal",u=r.findIndex(R=>R.drag===n),v=r[a],S=r[u].clientRect,N=v.clientRect,Y=u>a?1:-1,ht=this._getItemOffsetPx(S,N,Y),xn=this._getSiblingOffsetPx(u,r,Y),wn=r.slice();return De(r,u,a),r.forEach((R,Tn)=>{if(wn[Tn]===R)return;let zt=R.drag===n,ft=zt?ht:xn,Wt=zt?n.getPlaceholderElement():R.drag.getRootElement();R.offset+=ft;let jt=Math.round(R.offset*(1/R.drag.scale));m?(Wt.style.transform=ct(`translate3d(${jt}px, 0, 0)`,R.initialTransform),Le(R.clientRect,0,ft)):(Wt.style.transform=ct(`translate3d(0, ${jt}px, 0)`,R.initialTransform),Le(R.clientRect,ft,0));}),this._previousSwap.overlaps=Rt(N,e,i),this._previousSwap.drag=v.drag,this._previousSwap.delta=m?t.x:t.y,{previousIndex:u,currentIndex:a};}enter(n,e,i,t){let r=t==null||t<0?this._getItemIndexFromPointerPosition(n,e,i):t,a=this._activeDraggables,m=a.indexOf(n),u=n.getPlaceholderElement(),v=a[r];if(v===n&&(v=a[r+1]),!v&&(r==null||r===-1||r<a.length-1)&&this._shouldEnterAsFirstChild(e,i)&&(v=a[0]),m>-1&&a.splice(m,1),v&&!this._dragDropRegistry.isDragging(v)){let S=v.getRootElement();S.parentElement.insertBefore(u,S),a.splice(r,0,n);}else this._element.appendChild(u),a.push(n);u.style.transform="",this._cacheItemPositions();}withItems(n){this._activeDraggables=n.slice(),this._cacheItemPositions();}withSortPredicate(n){this._sortPredicate=n;}reset(){this._activeDraggables?.forEach(n=>{let e=n.getRootElement();if(e){let i=this._itemPositions.find(t=>t.drag===n)?.initialTransform;e.style.transform=i||"";}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1;}getActiveItemsSnapshot(){return this._activeDraggables;}getItemIndex(n){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(i=>i.drag===n);}updateOnScroll(n,e){this._itemPositions.forEach(({clientRect:i})=>{Le(i,n,e);}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition();});}withElementContainer(n){this._element=n;}_cacheItemPositions(){let n=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let i=e.getVisibleElement();return{drag:e,offset:0,initialTransform:i.style.transform||"",clientRect:qt(i)};}).sort((e,i)=>n?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top);}_getItemOffsetPx(n,e,i){let t=this.orientation==="horizontal",r=t?e.left-n.left:e.top-n.top;return i===-1&&(r+=t?e.width-n.width:e.height-n.height),r;}_getSiblingOffsetPx(n,e,i){let t=this.orientation==="horizontal",r=e[n].clientRect,a=e[n+i*-1],m=r[t?"width":"height"]*i;if(a){let u=t?"left":"top",v=t?"right":"bottom";i===-1?m-=a.clientRect[u]-r[v]:m+=r[u]-a.clientRect[v];}return m;}_shouldEnterAsFirstChild(n,e){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,t=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let a=i[i.length-1].clientRect;return t?n>=a.right:e>=a.bottom;}else{let a=i[0].clientRect;return t?n<=a.left:e<=a.top;}}_getItemIndexFromPointerPosition(n,e,i,t){let r=this.orientation==="horizontal",a=this._itemPositions.findIndex(({drag:m,clientRect:u})=>{if(m===n)return!1;if(t){let v=r?t.x:t.y;if(m===this._previousSwap.drag&&this._previousSwap.overlaps&&v===this._previousSwap.delta)return!1;}return r?e>=Math.floor(u.left)&&e<Math.floor(u.right):i>=Math.floor(u.top)&&i<Math.floor(u.bottom);});return a===-1||!this._sortPredicate(a,n)?-1:a;}},Lt=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(n,e){this._document=n,this._dragDropRegistry=e;}start(n){let e=this._element.childNodes;this._relatedNodes=[];for(let i=0;i<e.length;i++){let t=e[i];this._relatedNodes.push([t,t.nextSibling]);}this.withItems(n);}sort(n,e,i,t){let r=this._getItemIndexFromPointerPosition(n,e,i),a=this._previousSwap;if(r===-1||this._activeItems[r]===n)return null;let m=this._activeItems[r];if(a.drag===m&&a.overlaps&&a.deltaX===t.x&&a.deltaY===t.y)return null;let u=this.getItemIndex(n),v=n.getPlaceholderElement(),S=m.getRootElement();r>u?S.after(v):S.before(v),De(this._activeItems,u,r);let N=this._getRootNode().elementFromPoint(e,i);return a.deltaX=t.x,a.deltaY=t.y,a.drag=m,a.overlaps=S===N||S.contains(N),{previousIndex:u,currentIndex:r};}enter(n,e,i,t){let r=t==null||t<0?this._getItemIndexFromPointerPosition(n,e,i):t;r===-1&&(r=this._getClosestItemIndexToPointer(n,e,i));let a=this._activeItems[r],m=this._activeItems.indexOf(n);m>-1&&this._activeItems.splice(m,1),a&&!this._dragDropRegistry.isDragging(a)?(this._activeItems.splice(r,0,n),a.getRootElement().before(n.getPlaceholderElement())):(this._activeItems.push(n),this._element.appendChild(n.getPlaceholderElement()));}withItems(n){this._activeItems=n.slice();}withSortPredicate(n){this._sortPredicate=n;}reset(){let n=this._element,e=this._previousSwap;for(let i=this._relatedNodes.length-1;i>-1;i--){let[t,r]=this._relatedNodes[i];t.parentNode===n&&t.nextSibling!==r&&(r===null?n.appendChild(t):r.parentNode===n&&n.insertBefore(t,r));}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1;}getActiveItemsSnapshot(){return this._activeItems;}getItemIndex(n){return this._activeItems.indexOf(n);}updateOnScroll(){this._activeItems.forEach(n=>{this._dragDropRegistry.isDragging(n)&&n._sortFromLastPointerPosition();});}withElementContainer(n){n!==this._element&&(this._element=n,this._rootNode=void 0);}_getItemIndexFromPointerPosition(n,e,i){let t=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(i)),r=t?this._activeItems.findIndex(a=>{let m=a.getRootElement();return t===m||m.contains(t);}):-1;return r===-1||!this._sortPredicate(r,n)?-1:r;}_getRootNode(){return this._rootNode||(this._rootNode=je(this._element)||this._document),this._rootNode;}_getClosestItemIndexToPointer(n,e,i){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let t=1/0,r=-1;for(let a=0;a<this._activeItems.length;a++){let m=this._activeItems[a];if(m!==n){let{x:u,y:v}=m.getRootElement().getBoundingClientRect(),S=Math.hypot(e-u,i-v);S<t&&(t=S,r=a);}}return r;}},nn=.05,ln=.05,O=function(o){return o[o.NONE=0]="NONE",o[o.UP=1]="UP",o[o.DOWN=2]="DOWN",o;}(O||{}),I=function(o){return o[o.NONE=0]="NONE",o[o.LEFT=1]="LEFT",o[o.RIGHT=2]="RIGHT",o;}(I||{}),At=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new b();entered=new b();exited=new b();dropped=new b();sorted=new b();receivingStarted=new b();receivingStopped=new b();data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set();_viewportScrollSubscription=ge.EMPTY;_verticalScrollDirection=O.NONE;_horizontalScrollDirection=I.NONE;_scrollNode;_stopScrollTimers=new b();_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(n,e,i,t,r){this._dragDropRegistry=e,this._ngZone=t,this._viewportRuler=r;let a=this.element=X(n);this._document=i,this.withOrientation("vertical").withElementContainer(a),e.registerDropContainer(this),this._parentPositions=new lt(i);}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this);}isDragging(){return this._isDragging;}start(){this._draggingStarted(),this._notifyReceivingSiblings();}enter(n,e,i,t){this._draggingStarted(),t==null&&this.sortingDisabled&&(t=this._draggables.indexOf(n)),this._sortStrategy.enter(n,e,i,t),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:n,container:this,currentIndex:this.getItemIndex(n)});}exit(n){this._reset(),this.exited.next({item:n,container:this});}drop(n,e,i,t,r,a,m,u={}){this._reset(),this.dropped.next({item:n,currentIndex:e,previousIndex:i,container:this,previousContainer:t,isPointerOverContainer:r,distance:a,dropPoint:m,event:u});}withItems(n){let e=this._draggables;return this._draggables=n,n.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(e.filter(t=>t.isDragging()).every(t=>n.indexOf(t)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this;}withDirection(n){return this._direction=n,this._sortStrategy instanceof pt&&(this._sortStrategy.direction=n),this;}connectedTo(n){return this._siblings=n.slice(),this;}withOrientation(n){if(n==="mixed")this._sortStrategy=new Lt(this._document,this._dragDropRegistry);else{let e=new pt(this._dragDropRegistry);e.direction=this._direction,e.orientation=n,this._sortStrategy=e;}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,i)=>this.sortPredicate(e,i,this)),this;}withScrollableParents(n){let e=this._container;return this._scrollableElements=n.indexOf(e)===-1?[e,...n]:n.slice(),this;}withElementContainer(n){if(n===this._container)return this;let e=X(this.element),i=this._scrollableElements.indexOf(this._container),t=this._scrollableElements.indexOf(n);return i>-1&&this._scrollableElements.splice(i,1),t>-1&&this._scrollableElements.splice(t,1),this._sortStrategy&&this._sortStrategy.withElementContainer(n),this._cachedShadowRoot=null,this._scrollableElements.unshift(n),this._container=n,this;}getScrollableParents(){return this._scrollableElements;}getItemIndex(n){return this._isDragging?this._sortStrategy.getItemIndex(n):this._draggables.indexOf(n);}isReceiving(){return this._activeSiblings.size>0;}_sortItem(n,e,i,t){if(this.sortingDisabled||!this._domRect||!Wi(this._domRect,nn,e,i))return;let r=this._sortStrategy.sort(n,e,i,t);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:n});}_startScrollingIfNecessary(n,e){if(this.autoScrollDisabled)return;let i,t=O.NONE,r=I.NONE;if(this._parentPositions.positions.forEach((a,m)=>{m===this._document||!a.clientRect||i||Wi(a.clientRect,nn,n,e)&&([t,r]=Vn(m,a.clientRect,this._direction,n,e),(t||r)&&(i=m));}),!t&&!r){let{width:a,height:m}=this._viewportRuler.getViewportSize(),u={width:a,height:m,top:0,right:a,bottom:m,left:0};t=cn(u,e),r=mn(u,n),i=window;}i&&(t!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=t,this._horizontalScrollDirection=r,this._scrollNode=i,(t||r)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling());}_stopScrolling(){this._stopScrollTimers.next();}_draggingStarted(){let n=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=n.msScrollSnapType||n.scrollSnapType||"",n.scrollSnapType=n.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents();}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect;}_reset(){this._isDragging=!1;let n=this._container.style;n.scrollSnapType=n.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear();}_startScrollInterval=()=>{this._stopScrolling(),Zt(0,Kt).pipe(Ie(this._stopScrollTimers)).subscribe(()=>{let n=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===O.UP?n.scrollBy(0,-e):this._verticalScrollDirection===O.DOWN&&n.scrollBy(0,e),this._horizontalScrollDirection===I.LEFT?n.scrollBy(-e,0):this._horizontalScrollDirection===I.RIGHT&&n.scrollBy(e,0);});};_isOverContainer(n,e){return this._domRect!=null&&Rt(this._domRect,n,e);}_getSiblingContainerFromPosition(n,e,i){return this._siblings.find(t=>t._canReceive(n,e,i));}_canReceive(n,e,i){if(!this._domRect||!Rt(this._domRect,e,i)||!this.enterPredicate(n,this))return!1;let t=this._getShadowRoot().elementFromPoint(e,i);return t?t===this._container||this._container.contains(t):!1;}_startReceiving(n,e){let i=this._activeSiblings;!i.has(n)&&e.every(t=>this.enterPredicate(t,this)||this._draggables.indexOf(t)>-1)&&(i.add(n),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:n,receiver:this,items:e}));}_stopReceiving(n){this._activeSiblings.delete(n),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:n,receiver:this});}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(n=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(n);e&&this._sortStrategy.updateOnScroll(e.top,e.left);}else this.isReceiving()&&this._cacheParentPositions();});}_getShadowRoot(){if(!this._cachedShadowRoot){let n=je(this._container);this._cachedShadowRoot=n||this._document;}return this._cachedShadowRoot;}_notifyReceivingSiblings(){let n=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,n));}};function cn(o,n){let{top:e,bottom:i,height:t}=o,r=t*ln;return n>=e-r&&n<=e+r?O.UP:n>=i-r&&n<=i+r?O.DOWN:O.NONE;}function mn(o,n){let{left:e,right:i,width:t}=o,r=t*ln;return n>=e-r&&n<=e+r?I.LEFT:n>=i-r&&n<=i+r?I.RIGHT:I.NONE;}function Vn(o,n,e,i,t){let r=cn(n,t),a=mn(n,i),m=O.NONE,u=I.NONE;if(r){let v=o.scrollTop;r===O.UP?v>0&&(m=O.UP):o.scrollHeight-v>o.clientHeight&&(m=O.DOWN);}if(a){let v=o.scrollLeft;e==="rtl"?a===I.RIGHT?v<0&&(u=I.RIGHT):o.scrollWidth+v>o.clientWidth&&(u=I.LEFT):a===I.LEFT?v>0&&(u=I.LEFT):o.scrollWidth-v>o.clientWidth&&(u=I.RIGHT);}return[m,u];}var st=ke({passive:!1,capture:!0}),Mn=(()=>{class o{static ɵfac=function(i){return new(i||o)();};static ɵcmp=G({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(i,t){},styles:["@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}"],encapsulation:2,changeDetection:0});}return o;})(),pn=(()=>{class o{_ngZone=E(Ue);_document=E(Ft);_styleLoader=E(hi);_dropInstances=new Set();_dragInstances=new Set();_activeDragInstances=bt([]);_globalListeners=new Map();_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new b();pointerUp=new b();scroll=new b();constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e);}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._persistentTouchmoveListener,st);});}removeDropContainer(e){this._dropInstances.delete(e);}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._document.removeEventListener("touchmove",this._persistentTouchmoveListener,st);}startDragging(e,i){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(Mn),this._activeDragInstances.update(t=>[...t,e]),this._activeDragInstances().length===1)){let t=i.type.startsWith("touch"),r={handler:a=>this.pointerUp.next(a),options:!0};t?(this._globalListeners.set("touchend",r),this._globalListeners.set("touchcancel",r)):this._globalListeners.set("mouseup",r),this._globalListeners.set("scroll",{handler:a=>this.scroll.next(a),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:st}),t||this._globalListeners.set("mousemove",{handler:a=>this.pointerMove.next(a),options:st}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((a,m)=>{this._document.addEventListener(m,a.handler,a.options);});});}}stopDragging(e){this._activeDragInstances.update(i=>{let t=i.indexOf(e);return t>-1?(i.splice(t,1),[...i]):i;}),this._activeDragInstances().length===0&&this._clearGlobalListeners();}isDragging(e){return this._activeDragInstances().indexOf(e)>-1;}scrolled(e){let i=[this.scroll];return e&&e!==this._document&&i.push(new gt(t=>this._ngZone.runOutsideAngular(()=>{let a=m=>{this._activeDragInstances().length&&t.next(m);};return e.addEventListener("scroll",a,!0),()=>{e.removeEventListener("scroll",a,!0);};}))),qe(...i);}registerDirectiveNode(e,i){this._domNodesToDirectives??=new WeakMap(),this._domNodesToDirectives.set(e,i);}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e);}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null;}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete();}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault();};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e));};_clearGlobalListeners(){this._globalListeners.forEach((e,i)=>{this._document.removeEventListener(i,e.handler,e.options);}),this._globalListeners.clear();}static ɵfac=function(i){return new(i||o)();};static ɵprov=vt({token:o,factory:o.ɵfac,providedIn:"root"});}return o;})(),Nn={dragStartThreshold:5,pointerDirectionChangeThreshold:5},dn=(()=>{class o{_document=E(Ft);_ngZone=E(Ue);_viewportRuler=E(bi);_dragDropRegistry=E(pn);_renderer=E(ii).createRenderer(null,null);constructor(){}createDrag(e,i=Nn){return new Ot(e,i,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer);}createDropList(e){return new At(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler);}static ɵfac=function(i){return new(i||o)();};static ɵprov=vt({token:o,factory:o.ɵfac,providedIn:"root"});}return o;})(),rn=new _e("CDK_DRAG_PARENT");var kn=new _e("CdkDragHandle");var un=new _e("CDK_DRAG_CONFIG"),hn=new _e("CdkDropList"),fn=(()=>{class o{element=E(yt);dropContainer=E(hn,{optional:!0,skipSelf:!0});_ngZone=E(Ue);_viewContainerRef=E(ni);_dir=E(Vt,{optional:!0});_changeDetectorRef=E(Me);_selfHandle=E(kn,{optional:!0,self:!0});_parentDrag=E(rn,{optional:!0,skipSelf:!0});_dragDropRegistry=E(pn);_destroyed=new b();_handles=new $t([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled);}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled;}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new T();released=new T();ended=new T();entered=new T();exited=new T();dropped=new T();moved=new gt(e=>{let i=this._dragRef.moved.pipe(de(t=>({source:this,pointerPosition:t.pointerPosition,event:t.event,delta:t.delta,distance:t.distance}))).subscribe(e);return()=>{i.unsubscribe();};});_injector=E(Xt);constructor(){let e=this.dropContainer,i=E(un,{optional:!0}),t=E(dn);this._dragRef=t.createDrag(this.element,{dragStartThreshold:i&&i.dragStartThreshold!=null?i.dragStartThreshold:5,pointerDirectionChangeThreshold:i&&i.pointerDirectionChangeThreshold!=null?i.pointerDirectionChangeThreshold:5,zIndex:i?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),i&&this._assignDefaults(i),e&&(this._dragRef._withDropContainer(e._dropListRef),e.addItem(this),e._dropListRef.beforeStarted.pipe(Ie(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale;})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef);}getPlaceholderElement(){return this._dragRef.getPlaceholderElement();}getRootElement(){return this._dragRef.getRootElement();}reset(){this._dragRef.reset();}getFreeDragPosition(){return this._dragRef.getFreeDragPosition();}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e);}ngAfterViewInit(){ei(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition);},{injector:this._injector});}ngOnChanges(e){let i=e.rootElementSelector,t=e.freeDragPosition;i&&!i.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,t&&!t.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition);}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose();});}_addHandle(e){let i=this._handles.getValue();i.push(e),this._handles.next(i);}_removeHandle(e){let i=this._handles.getValue(),t=i.indexOf(e);t>-1&&(i.splice(t,1),this._handles.next(i));}_setPreviewTemplate(e){this._previewTemplate=e;}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null);}_setPlaceholderTemplate(e){this._placeholderTemplate=e;}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null);}_updateRootElement(){let e=this.element.nativeElement,i=e;this.rootElementSelector&&(i=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(i||e);}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):X(e):null;}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let i=this._dir,t=this.dragStartDelay,r=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,a=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof t=="object"&&t?t:Pt(t),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(r).withPreviewTemplate(a).withPreviewContainer(this.previewContainer||"global"),i&&e.withDirection(i.value);}}),e.beforeStarted.pipe(Yt(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return;}let i=this.element.nativeElement.parentElement;for(;i;){let t=this._dragDropRegistry.getDragDirectiveForNode(i);if(t){e.withParent(t._dragRef);break;}i=i.parentElement;}});}_handleEvents(e){e.started.subscribe(i=>{this.started.emit({source:this,event:i.event}),this._changeDetectorRef.markForCheck();}),e.released.subscribe(i=>{this.released.emit({source:this,event:i.event});}),e.ended.subscribe(i=>{this.ended.emit({source:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck();}),e.entered.subscribe(i=>{this.entered.emit({container:i.container.data,item:this,currentIndex:i.currentIndex});}),e.exited.subscribe(i=>{this.exited.emit({container:i.container.data,item:this});}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,isPointerOverContainer:i.isPointerOverContainer,item:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event});});}_assignDefaults(e){let{lockAxis:i,dragStartDelay:t,constrainPosition:r,previewClass:a,boundaryElement:m,draggingDisabled:u,rootElementSelector:v,previewContainer:S}=e;this.disabled=u??!1,this.dragStartDelay=t||0,i&&(this.lockAxis=i),r&&(this.constrainPosition=r),a&&(this.previewClass=a),m&&(this.boundaryElement=m),v&&(this.rootElementSelector=v),S&&(this.previewContainer=S);}_setupHandlesListener(){this._handles.pipe(Jt(e=>{let i=e.map(t=>t.element);this._selfHandle&&this.rootElementSelector&&i.push(this.element),this._dragRef.withHandles(i);}),Qt(e=>qe(...e.map(i=>i._stateChanges.pipe(q(i))))),Ie(this._destroyed)).subscribe(e=>{let i=this._dragRef,t=e.element.nativeElement;e.disabled?i.disableHandle(t):i.enableHandle(t);});}static ɵfac=function(i){return new(i||o)();};static ɵdir=Pe({type:o,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,t){i&2&&Ve("cdk-drag-disabled",t.disabled)("cdk-drag-dragging",t._dragRef.isDragging());},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",Ne],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",mi]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[Dt([{provide:rn,useExisting:o}]),Ct,J]});}return o;})(),on=new _e("CdkDropListGroup");var gn=(()=>{class o{element=E(yt);_changeDetectorRef=E(Me);_scrollDispatcher=E(yi);_dir=E(Vt,{optional:!0});_group=E(on,{optional:!0,skipSelf:!0});_destroyed=new b();_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=E(vi).getId("cdk-drop-list-");lockAxis;get disabled(){return this._disabled||!!this._group&&this._group.disabled;}set disabled(e){this._dropListRef.disabled=this._disabled=e;}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;dropped=new T();entered=new T();exited=new T();sorted=new T();_unsortedItems=new Set();constructor(){let e=E(dn),i=E(un,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,i&&this._assignDefaults(i),this._dropListRef.enterPredicate=(t,r)=>this.enterPredicate(t.data,r.data),this._dropListRef.sortPredicate=(t,r,a)=>this.sortPredicate(t,r.data,a.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),o._dropLists.push(this),this._group&&this._group._items.add(this);}addItem(e){this._unsortedItems.add(e),this._dropListRef.isDragging()&&this._syncItemsWithRef();}removeItem(e){this._unsortedItems.delete(e),this._dropListRef.isDragging()&&this._syncItemsWithRef();}getSortedItems(){return Array.from(this._unsortedItems).sort((e,i)=>e._dragRef.getVisibleElement().compareDocumentPosition(i._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1);}ngOnDestroy(){let e=o._dropLists.indexOf(this);e>-1&&o._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete();}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(q(this._dir.value),Ie(this._destroyed)).subscribe(i=>e.withDirection(i)),e.beforeStarted.subscribe(()=>{let i=fi(this.connectedTo).map(t=>{if(typeof t=="string"){let r=o._dropLists.find(a=>a.id===t);return r;}return t;});if(this._group&&this._group._items.forEach(t=>{i.indexOf(t)===-1&&i.push(t);}),!this._scrollableParentsResolved){let t=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(r=>r.getElementRef().nativeElement);this._dropListRef.withScrollableParents(t),this._scrollableParentsResolved=!0;}if(this.elementContainerSelector){let t=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(t);}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=Pt(this.autoScrollStep,2),e.connectedTo(i.filter(t=>t&&t!==this).map(t=>t._dropListRef)).withOrientation(this.orientation);});}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(),this._changeDetectorRef.markForCheck();}),e.entered.subscribe(i=>{this.entered.emit({container:this,item:i.item.data,currentIndex:i.currentIndex});}),e.exited.subscribe(i=>{this.exited.emit({container:this,item:i.item.data}),this._changeDetectorRef.markForCheck();}),e.sorted.subscribe(i=>{this.sorted.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,container:this,item:i.item.data});}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,item:i.item.data,isPointerOverContainer:i.isPointerOverContainer,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck();}),qe(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck());}_assignDefaults(e){let{lockAxis:i,draggingDisabled:t,sortingDisabled:r,listAutoScrollDisabled:a,listOrientation:m}=e;this.disabled=t??!1,this.sortingDisabled=r??!1,this.autoScrollDisabled=a??!1,this.orientation=m||"vertical",i&&(this.lockAxis=i);}_syncItemsWithRef(){this._dropListRef.withItems(this.getSortedItems().map(e=>e._dragRef));}static ɵfac=function(i){return new(i||o)();};static ɵdir=Pe({type:o,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(i,t){i&2&&(ri("id",t.id),Ve("cdk-drop-list-disabled",t.disabled)("cdk-drop-list-dragging",t._dropListRef.isDragging())("cdk-drop-list-receiving",t._dropListRef.isReceiving()));},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",Ne],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",Ne],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",Ne],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[Dt([{provide:on,useValue:void 0},{provide:hn,useExisting:o}]),Ct]});}return o;})();function dt(o){return[D.deviceIdentifiers,D.deviceSWversion,D.deviceSerialNumber].includes(o);}var Rn=()=>["button","binary"],Gn=()=>["number","binary"];function On(o,n){o&1&&(l(0,"mat-error"),d(1," The value is lower than the minimum "),s());}function Ln(o,n){o&1&&(l(0,"mat-error"),d(1," The value is greater than the maximum "),s());}function An(o,n){if(o&1){let e=C();P(0),l(1,"mat-form-field",1)(2,"mat-label"),d(3,"MQTT Value"),s(),l(4,"input",2),h("change",function(){g(e);let t=f();return _(t.onNumberChange());})("keyup.enter",function(){g(e);let t=f();return _(t.onNumberChange());}),s(),y(5,On,2,0,"mat-error",0)(6,Ln,2,0,"mat-error",0),s(),d(7),V();}if(o&2){let e=f();c(4),p("formControl",e.numberFormControl)("step",e.step)("min",e.min)("max",e.max),c(),p("ngIf",e.numberFormControl.hasError("min")),c(),p("ngIf",e.numberFormControl.hasError("max")),c(),x("",e.getUom(),`
`);}}function qn(o,n){if(o&1){let e=C();P(0),l(1,"mat-form-field",3)(2,"mat-label"),d(3,"MQTT Value"),s(),l(4,"input",4),h("change",function(t){g(e);let r=f();return _(r.onTextChange(t));}),s()(),V();}if(o&2){let e=f();c(4),p("formControl",e.textFormControl);}}function Un(o,n){if(o&1&&(l(0,"mat-option",7),d(1),s()),o&2){let e=n.$implicit;p("value",e.key),c(),x(" ",e.name," ");}}function Bn(o,n){if(o&1){let e=C();P(0),l(1,"mat-form-field",3)(2,"mat-label"),d(3,"Options"),s(),l(4,"mat-select",5),h("selectionChange",function(){g(e);let t=f();return _(t.onOptionChange());}),y(5,Un,2,2,"mat-option",6),s()(),V();}if(o&2){let e=f();c(4),p("formControl",e.optionsFormControl),c(),p("ngForOf",e.getOptions());}}function Hn(o,n){if(o&1){let e=C();P(0),l(1,"mat-slide-toggle",8),h("toggleChange",function(){g(e);let t=f();return _(t.onButton());}),s(),V();}if(o&2){let e=f();c(),p("formControl",e.toggleFormControl);}}function zn(o,n){if(o&1&&(P(0),l(1,"mat-form-field",1)(2,"mat-label"),d(3,"MQTT Value"),s(),k(4,"input",9),s(),d(5),V()),o&2){let e=f();c(4),p("formControl",e.textFormControl),c(),x("",e.getUom()," ");}}var _n=(()=>{class o{constructor(){this.uom="",this.step=void 0,this.min=void 0,this.max=void 0,this.optionsFormControl=new ne(null),this.numberFormControl=new ne(null),this.textFormControl=new ne(null),this.toggleFormControl=new ne(null);}onTextChange(e){this.textFormControl.value&&this.entity&&this.specificationMethods.postModbusWriteMqtt(this.entity,this.textFormControl.value.toString()).subscribe(i=>{this.textFormControl.setValue(i);});}onNumberChange(){this.numberFormControl.value&&this.entity&&this.specificationMethods.postModbusWriteMqtt(this.entity,this.numberFormControl.value.toString()).subscribe(e=>{this.textFormControl.setValue(e);});}onButton(){if(this.toggleFormControl.value&&this.entity){let e=this.toggleFormControl.value?"ON":"OFF";this.specificationMethods.postModbusWriteMqtt(this.entity,e).subscribe(i=>{this.toggleFormControl.setValue(i=="ON");});}}onOptionChange(){if(this.entity){let e=this.entity.converterParameters.options.find(i=>i.key==this.optionsFormControl.value);e&&this.entity&&this.specificationMethods.postModbusWriteMqtt(this.entity,e.name).subscribe(i=>{let t=this.entity.converterParameters.options.find(r=>r.name==i);t&&this.optionsFormControl.setValue(t.key);});}}ngOnDestroy(){this.sub!=null&&this.sub.unsubscribe();}isSensor(){return!this.entity||this.entity.readonly;}getConverterName(){return this.entity&&this.entity.converter&&this.entity.converter.name?this.entity.converter.name:"sensor";}getMqttValue(){return this.entity&&this.entity.mqttValue!=null?this.entity.mqttValue:"";}ngOnChanges(e){this.entity2Form();}entity2Form(){if(this.entity){let e=this.entity.name;this.entityName=e||"";let i;switch(this.entity.converter.name){case"number":this.entity.mqttValue!=null&&typeof this.entity.mqttValue=="number"&&this.numberFormControl.setValue(parseFloat(Number.parseFloat(this.getMqttValue().toString()).toFixed(this.entity.converterParameters.decimals)));let t=this.entity.converterParameters;t!=null&&(t.step&&(this.step=t.step),i=this.numberFormControl,i.clearValidators(),t.identification!=null&&t.identification.min&&i.addValidators(w.min(t.identification.min)),t.identification!=null&&t.identification.max&&i.addValidators(w.max(t.identification.max)));break;case"select":this.entity.modbusValue&&(this.entity.readonly?(this.textFormControl.setValue(this.entity.mqttValue!=null?this.entity.mqttValue:""),i=this.textFormControl):(this.optionsFormControl.setValue(this.entity.modbusValue[0]),i=this.optionsFormControl));break;case"text":i=this.textFormControl,this.entity.mqttValue&&i.setValue(this.getMqttValue());break;case"binary":i=this.toggleFormControl,this.entity.mqttValue&&i.setValue(this.entity.mqttValue=="ON");break;case"value":}i&&(this.entity.readonly?i.disable():i.enable());}}ngOnInit(){this.entity2Form(),this.mqttValueObservable&&(this.sub=this.mqttValueObservable.subscribe(e=>{this.entity&&e&&(this.entity.modbusValue=e.modbusValue,this.entity.mqttValue=e.mqttValue,this.entity.identified=e.identified,this.entity2Form());}));}getUom(){return this.entity&&this.specificationMethods?this.specificationMethods.getUom(this.entity.id):"";}getOptions(){if(this.entity){let e=this.entity.converterParameters.options;if(e)return e;}return[];}static{this.ɵfac=function(i){return new(i||o)();};}static{this.ɵcmp=G({type:o,selectors:[["app-entity-value-control"]],inputs:{entity:"entity",uom:"uom",specificationMethods:"specificationMethods",mqttValueObservable:"mqttValueObservable"},features:[J],decls:5,vars:7,consts:[[4,"ngIf"],[1,"width100pt"],["matInput","","type","number",3,"change","keyup.enter","formControl","step","min","max"],[1,"width150pt"],["matInput","",3,"change","formControl"],["matInput","",3,"selectionChange","formControl"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"toggleChange","formControl"],["matInput","",3,"formControl"]],template:function(i,t){i&1&&y(0,An,8,7,"ng-container",0)(1,qn,5,1,"ng-container",0)(2,Bn,6,2,"ng-container",0)(3,Hn,2,1,"ng-container",0)(4,zn,6,2,"ng-container",0),i&2&&(p("ngIf",t.getConverterName()=="number"),c(),p("ngIf",t.getConverterName().indexOf("text")>=0&&!t.entity.readonly),c(),p("ngIf",t.getConverterName()=="select"&&!t.entity.readonly),c(),p("ngIf",ve(5,Rn).includes(t.getConverterName())),c(),p("ngIf",t.entity.readonly&&!ve(6,Gn).includes(t.getConverterName())));},dependencies:[B,z,H,Z,$,W,Xe,j,Ni,Mi,K,Vi,Ke,rt,U,$e,xe],encapsulation:2});}}return o;})();var Ae=o=>({errorText:o}),Wn=()=>["binary_sensor","button"],jn=()=>[];function $n(o,n){if(o&1){let e=C();P(0),l(1,"button",37),h("click",function(){g(e);let t=f(2);return _(t.restoreEntity());}),l(2,"mat-icon"),d(3,"undo"),s()(),V();}}function Kn(o,n){if(o&1){let e=C();P(0),y(1,$n,4,0,"ng-container",13),l(2,"button",35),h("click",function(){g(e);let t=f();return _(t.copyEntity());}),l(3,"mat-icon"),d(4,"file_copy"),s()(),l(5,"button",36),h("click",function(){g(e);let t=f();return _(t.specificationMethods?t.specificationMethods.deleteEntity(t.entity.id):null);}),l(6,"mat-icon"),d(7,"delete"),s()(),V();}if(o&2){let e=f();c(),p("ngIf",!e.allFormGroups.pristine);}}function Zn(o,n){if(o&1){let e=C();P(0),l(1,"button",38),h("click",function(){g(e);let t=f();return _(t.addEntity());}),l(2,"mat-icon"),d(3,"add_circle"),s()(),V();}if(o&2){let e=f();c(),p("disabled",!e.canSaveEntity());}}function Yn(o,n){o&1&&k(0,"br");}function Qn(o,n){o&1&&(l(0,"mat-error"),d(1,' Required! "Set Value" is empty '),s());}function Jn(o,n){o&1&&(l(0,"mat-error"),d(1," Must be unique within table "),s());}function Xn(o,n){o&1&&(l(0,"mat-error"),d(1," Required! "),s());}function er(o,n){o&1&&(l(0,"mat-error"),d(1," This field is required "),s());}function tr(o,n){o&1&&(l(0,"mat-error"),d(1," Range is 1-65536 "),s());}function ir(o,n){if(o&1&&(l(0,"mat-option",39),d(1),s()),o&2){let e=n.$implicit;p("value",e),c(),x(" ",e.name," ");}}function nr(o,n){o&1&&(l(0,"mat-error"),d(1," This field is required "),s());}function rr(o,n){if(o&1&&(l(0,"mat-option",39),d(1),s()),o&2){let e=n.$implicit;p("value",e),c(),x(" ",e.name," ");}}function or(o,n){if(o&1&&(l(0,"mat-option",39),d(1),s()),o&2){let e=n.$implicit;p("value",e),c(),x(" ",e," ");}}function ar(o,n){if(o&1&&(l(0,"mat-option",39),d(1),s()),o&2){let e=n.$implicit;p("value",e),c(),x(" ",e.name," ");}}function sr(o,n){if(o&1){let e=C();l(0,"input",55),h("change",function(){g(e);let t=f(2);return _(t.form2Entity());}),s();}}function lr(o,n){if(o&1&&(l(0,"mat-option",39),d(1),s()),o&2){let e=n.$implicit;p("value",e),c(),x(" ",e," ");}}function cr(o,n){if(o&1){let e=C();l(0,"mat-select",56),h("selectionChange",function(){g(e);let t=f(2);return _(t.onConverterValueChange());}),y(1,lr,2,2,"mat-option",28),s();}if(o&2){let e=f(2);c(),p("ngForOf",e.numberPropertiesFormGroup.get("deviceClass").value.uom);}}function mr(o,n){o&1&&(l(0,"mat-error"),d(1," This field is required "),s());}function pr(o,n){o&1&&(l(0,"mat-error"),d(1," This field is required "),s());}function dr(o,n){o&1&&(l(0,"mat-error"),d(1," This field is required "),s());}function ur(o,n){if(o&1){let e=C();l(0,"mat-form-field",52)(1,"mat-label"),d(2,"Step"),s(),l(3,"input",57),h("change",function(){g(e);let t=f(2);return _(t.onConverterValueChange());}),s()();}}function hr(o,n){if(o&1){let e=C();l(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title",17)(3,"p",14),d(4,"Number Converter Properties"),s()()(),l(5,"form",18)(6,"div",19)(7,"div",22)(8,"mat-form-field",32)(9,"mat-label"),d(10,"Device Class"),s(),l(11,"mat-select",40),h("selectionChange",function(){g(e);let t=f();return _(t.onConverterValueChange());}),y(12,ar,2,2,"mat-option",28),s()(),l(13,"mat-form-field",41)(14,"mat-label"),d(15,"UOM"),s(),y(16,sr,1,0,"input",42)(17,cr,2,1,"mat-select",43),s(),l(18,"mat-form-field",32)(19,"mat-label"),d(20,"State Class"),s(),l(21,"mat-select",44),h("selectionChange",function(){g(e);let t=f();return _(t.onConverterValueChange());}),l(22,"mat-option",39),d(23,"None"),s(),l(24,"mat-option",39),d(25,"Measurement"),s(),l(26,"mat-option",39),d(27,"Total"),s(),l(28,"mat-option",39),d(29,"Total increasing"),s()()()(),l(30,"div",22)(31,"mat-form-field",41)(32,"mat-label"),d(33,"Multiplier"),s(),l(34,"input",45,5),h("change",function(){g(e);let t=f();return _(t.onConverterValueChange());}),s(),y(36,mr,2,0,"mat-error",13),s(),l(37,"mat-form-field",46)(38,"mat-label"),d(39,"Offset"),s(),l(40,"input",47,6),h("change",function(){g(e);let t=f();return _(t.onConverterValueChange());}),s(),y(42,pr,2,0,"mat-error",13),s(),l(43,"mat-form-field",48)(44,"mat-label"),d(45,"Number Format"),s(),l(46,"mat-select",49),h("selectionChange",function(){g(e);let t=f();return _(t.onConverterValueChange());}),l(47,"mat-option",39),d(48,"Unsigned Int 16"),s(),l(49,"mat-option",39),d(50,"Signed Int 16"),s(),l(51,"mat-option",39),d(52,"Unsigned Int 32"),s(),l(53,"mat-option",39),d(54,"Signed Int 32"),s(),l(55,"mat-option",39),d(56,"Float 32"),s()(),y(57,dr,2,0,"mat-error",13),s(),l(58,"mat-form-field",41)(59,"mat-label"),d(60,"Decimals"),s(),l(61,"mat-select",50),h("selectionChange",function(){g(e);let t=f();return _(t.onConverterValueChange());}),k(62,"mat-option",39),l(63,"mat-option",39),d(64,"0"),s(),l(65,"mat-option",39),d(66,"1"),s(),l(67,"mat-option",39),d(68,"2"),s(),l(69,"mat-option",39),d(70,"3"),s(),l(71,"mat-option",39),d(72,"4"),s()()()(),l(73,"h3",32),d(74),s(),l(75,"div",22)(76,"mat-form-field",41)(77,"mat-label"),d(78,"Min"),s(),l(79,"input",51),h("change",function(){g(e);let t=f();return _(t.onConverterValueChange());}),s()(),l(80,"mat-form-field",52)(81,"mat-label"),d(82,"Max"),s(),l(83,"input",53),h("change",function(){g(e);let t=f();return _(t.onConverterValueChange());}),s()(),y(84,ur,4,0,"mat-form-field",54),s()()()();}if(o&2){let e=f();c(2),p("matTooltip",e.numberPropertiesFormGroup.valid?"":"This panel has errors"),c(),p("ngClass",L(32,Ae,!e.numberPropertiesFormGroup.valid)),c(2),p("formGroup",e.numberPropertiesFormGroup),c(6),p("compareWith",e.compareName),c(),p("ngForOf",e.getDeviceClasses()),c(4),p("ngIf",!e.deviceClassHasUoms()),c(),p("ngIf",e.deviceClassHasUoms()),c(4),p("errorStateMatcher",e.errorStateMatcher)("compareWith",e.compareNumber),c(),p("value",0),c(2),p("value",1),c(2),p("value",2),c(2),p("value",3),c(8),p("ngIf",e.numberPropertiesFormGroup.get("multiplier").hasError("required")),c(6),p("ngIf",e.numberPropertiesFormGroup.get("offset").hasError("required")),c(4),p("errorStateMatcher",e.errorStateMatcher)("compareWith",e.compareNumber),c(),p("value",0),c(2),p("value",2),c(2),p("value",3),c(2),p("value",4),c(2),p("value",1),c(2),p("ngIf",e.numberPropertiesFormGroup.get("numberFormat").hasError("required")),c(4),p("compareWith",e.compareNumber),c(),p("value",-1),c(),p("value",0),c(2),p("value",1),c(2),p("value",2),c(2),p("value",3),c(2),p("value",4),c(3),x(" Identification",e.entity.readonly?"":"/step",""),c(10),p("ngIf",!e.entity.readonly);}}function fr(o,n){o&1&&(l(0,"mat-error"),d(1," This field is required "),s());}function gr(o,n){if(o&1){let e=C();l(0,"mat-expansion-panel")(1,"mat-expansion-panel-header",17)(2,"mat-panel-title")(3,"p",14),d(4," Text Converter Properties"),s()()(),l(5,"form",18)(6,"mat-form-field",20)(7,"mat-label"),d(8,"max. Num Chars."),s(),l(9,"input",58,7),h("change",function(){g(e);let t=f();return _(t.onConverterValueChange());}),s(),y(11,fr,2,0,"mat-error",13),s(),l(12,"mat-form-field",20)(13,"mat-label"),d(14,"Expression for identification"),s(),l(15,"input",59,8),h("change",function(){g(e);let t=f();return _(t.onConverterValueChange());}),s()()()();}if(o&2){let e=f();c(),p("matTooltip",e.numberPropertiesFormGroup.valid?"":"This panel has errors"),c(2),p("ngClass",L(4,Ae,!e.numberPropertiesFormGroup.valid)),c(2),p("formGroup",e.stringPropertiesFormGroup),c(6),p("ngIf",e.stringPropertiesFormGroup.get("stringlength").hasError("required"));}}function _r(o,n){if(o&1){let e=C();l(0,"button",71),h("click",function(){g(e);let t=f().$implicit,r=f(2);return _(r.deleteOption(t));}),l(1,"mat-icon"),d(2,"delete"),s()();}}function vr(o,n){if(o&1&&(l(0,"span",66)(1,"div",67),d(2),s(),l(3,"div",68),d(4),s(),l(5,"div",69),y(6,_r,3,0,"button",70),s()()),o&2){let e=n.$implicit,i=f(2);c(2),M(e.key),c(2),x(" ",e.name,""),c(2),p("ngIf",i.entity);}}function yr(o,n){o&1&&(l(0,"mat-error"),d(1," This field is required "),s());}function br(o,n){o&1&&(l(0,"mat-error"),d(1," The value must be unique in the table "),s());}function Cr(o,n){o&1&&(l(0,"mat-error"),d(1," This field is required "),s());}function Sr(o,n){o&1&&(l(0,"mat-error"),d(1," The value must be unique in the table "),s());}function Er(o,n){if(o&1&&(l(0,"mat-option",39),d(1),s()),o&2){let e=n.$implicit;p("value",e),c(),x(" ",e.name," ");}}function xr(o,n){if(o&1&&(l(0,"mat-form-field",20)(1,"mat-label"),d(2,"Device Class"),s(),l(3,"mat-select",72),y(4,Er,2,2,"mat-option",28),s()()),o&2){let e=f(2);c(4),p("ngForOf",e.getDeviceClasses());}}function wr(o,n){if(o&1){let e=C();l(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),d(3," Select Converter Properties "),s()(),l(4,"form",18)(5,"div",60),h("cdkDropListDropped",function(t){g(e);let r=f();return _(r.dropOptions(t));}),y(6,vr,7,3,"span",61),s(),l(7,"div",22)(8,"mat-form-field",25)(9,"input",62,9),h("keyup.enter",function(){g(e);let t=f();return _(t.addOption());}),s(),y(11,yr,2,0,"mat-error",13)(12,br,2,0,"mat-error",13),s(),l(13,"mat-form-field",20)(14,"input",63,10),h("keyup.enter",function(){g(e);let t=f();return _(t.addOption());}),s(),y(16,Cr,2,0,"mat-error",13)(17,Sr,2,0,"mat-error",13),s(),l(18,"button",64),h("click",function(){g(e);let t=f();return _(t.addOption());}),l(19,"mat-icon"),d(20,"add_box"),s()()(),y(21,xr,5,1,"mat-form-field",65),s()();}if(o&2){let e=f();c(4),p("formGroup",e.selectPropertiesFormGroup),c(2),p("ngForOf",e.getCurrentOptions()?e.getCurrentOptions():ve(8,jn)),c(5),p("ngIf",e.selectPropertiesFormGroup.get("optionModbus").hasError("required")),c(),p("ngIf",e.selectPropertiesFormGroup.get("optionModbus").hasError("unique")),c(4),p("ngIf",e.selectPropertiesFormGroup.get("optionMqtt").hasError("required")),c(),p("ngIf",e.selectPropertiesFormGroup.get("optionMqtt").hasError("unique")),c(),p("disabled",!e.canAddOption()),c(3),p("ngIf",e.getShowExpertOptions());}}function Tr(o,n){if(o&1&&(l(0,"mat-option",39),d(1),s()),o&2){let e=n.$implicit;p("value",e.id),c(),x(" ",e.name," ");}}function Dr(o,n){if(o&1&&(l(0,"mat-option",39),d(1),s()),o&2){let e=n.$implicit;p("value",e.id),c(),x(" ",e.name?e.name:e.id," ");}}function Fr(o,n){o&1&&(l(0,"mat-error"),d(1," Referenced Entity and Set Value must be unique "),s());}function Ir(o,n){if(o&1){let e=C();l(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title",17)(3,"p",14),d(4),s()()(),l(5,"form",18)(6,"div",19)(7,"mat-form-field",20)(8,"mat-label"),d(9,"Set Value "),s(),l(10,"mat-select",73),h("selectionChange",function(){g(e);let t=f();return _(t.onEntityNameValueChange());}),y(11,Tr,2,2,"mat-option",28),k(12,"mat-option",39),l(13,"mat-option",39),d(14,"Serial Number"),s(),l(15,"mat-option",39),d(16,"Software Version"),s(),l(17,"mat-option",39),d(18,"Identification for Discovery"),s(),l(19,"mat-option",39),d(20,"Multiplier"),s(),l(21,"mat-option",39),d(22,"Offset"),s(),l(23,"mat-option",39),d(24,"Unit of Measurement"),s()()(),l(25,"mat-form-field",20)(26,"mat-label"),d(27,"Referenced Entity"),s(),l(28,"mat-select",74),h("selectionChange",function(){g(e);let t=f();return _(t.onVariableEntityValueChange());}),y(29,Dr,2,2,"mat-option",28),s(),y(30,Fr,2,0,"mat-error",13),s()()()();}if(o&2){let e,i=f();c(2),p("matTooltip",i.variableFormGroup.valid?"":"This panel has errors"),c(),p("ngClass",L(18,Ae,!i.variableFormGroup.valid)),c(),x(" Variable Properties ",i.entity.readonly?"":" and MQTT topic",""),c(),p("formGroup",i.variableFormGroup),c(5),p("compareWith",i.compareNumber),c(),p("ngForOf",i.variableTypes),c(),p("value",0),c(),p("value",5),c(2),p("value",6),c(2),p("value",1),c(2),p("value",3),c(2),p("value",4),c(2),p("value",2),c(5),p("compareWith",i.compareNumber)("errorStateMatcher",i.errorStateMatcher)("errorStateMatcher",i.errorStateMatcher),c(),p("ngForOf",i.xxx),c(),p("ngIf",((e=i.entityFormGroup.get("variableEntity"))==null?null:e.hasError("unique"))!=null);}}var Fe="name",Pr="optionModbus",vn="optionMqtt",pe="variableType",he="variableEntity",fe="mqttname",Bt={name:"",registerType:A.HoldingRegister,readonly:!0,modbusValue:[0],mqttValue:"",identified:ee.unknown,converter:{name:"number",registerTypes:[A.HoldingRegister,A.AnalogInputs]},modbusAddress:0,id:-1},yn=(()=>{class o extends Ze{onMqttValueChange(e,i){e.target.value="YYYY";}onMqttKeyPress(e){return!("a"<=e.key&&e.key<="z")&&!("A"<=e.key&&e.key<="Z")&&!("0"<=e.key&&e.key<="9")?(e.stopImmediatePropagation(),!1):!0;}constructor(e,i){super(),this.entityApiService=e,this.fb=i,this.variableTypes=[{id:D.noParam,name:""},{id:D.deviceIdentifiers,name:"Identification for Discovery"},{id:D.deviceSerialNumber,name:"Serial Number"},{id:D.deviceSWversion,name:"Software Version"},{id:D.entityMultiplier,name:"Multiplier"},{id:D.entityOffset,name:"Offset"},{id:D.entityUom,name:"Unit of Measurement"}],this.entity=structuredClone(Bt),this.disabled=!0,this.entityCategories=["","config","diagnostic"],this.mqttValueObservable=new b(),this.allFormGroups=this.fb.group({}),this.registerTypes=[{registerType:A.HoldingRegister,name:"Holding Registers"},{registerType:A.AnalogInputs,name:"Analog Input"},{registerType:A.Coils,name:"Coils"},{registerType:A.DiscreteInputs,name:"Discrete Inputs"}],this.entitiesDisplayedColumns=["select",Fe,"identified","mqttValue","action"],this.nameListCompare=(t,r)=>t.name===r.name,this.uniqueNameValidator=t=>this.entity.converter.name!="select"||this.getCurrentOptions().find(r=>r.name==t.value)==null?null:{unique:t.value},this.uniqueKeyValidator=t=>this.getCurrentOptions().find(r=>r.key==t.value)==null?null:{unique:t.value},this.entityNameValidator=t=>this.variableFormGroup?this.isVariableType()||t.value!=null&&t.value.length>0?null:{required:t.value}:{invalid:t.value},this.entityMqttNameValidator=t=>this.variableFormGroup&&this.entity&&this.specificationMethods?this.specificationMethods.getMqttNames(this.entity.id).find(a=>a&&a==t.value)?{unique:t.value}:this.entity&&this.isVariableType()||t.value!=null&&t.value.length>0?null:{required:t.value}:{invalid:t.value},this.selectOptionsValidator=t=>(this.entity?.converterParameters).options&&(this.entity?.converterParameters).options.length>0?null:{empty:t.value},this.variableEntityValidator=t=>{if(!this.variableFormGroup)return null;let r=this.variableFormGroup.get(pe);return dt(r.value)?null:t==null||t.value==null||t.value==0?{invalid:t.value}:this.specificationMethods.hasDuplicateVariableConfigurations(t.value.id,r.value)?{unique:t.value}:null;},this.errorStateMatcher=new Oi(),this.xxx=[{id:4,name:"ent 4"}];}ngOnInit(){this.entityFormGroup=this.fb.group({name:[null,this.entityNameValidator.bind(this)],mqttname:[null,this.entityMqttNameValidator.bind(this)],converter:[null,w.required],modbusAddress:[null,w.compose([w.required,w.min(0),w.max(65536)])],registerType:[null,w.required],readonly:[null],entityCategory:[""],icon:[null],forceUpdate:[!1],value_template:[null]}),this.variableFormGroup=this.fb.group({variableType:[null],variableEntity:[null,this.variableEntityValidator.bind(this)]}),this.numberPropertiesFormGroup=this.fb.group({deviceClass:[null],stateClass:[null],multiplier:[1,w.required],offset:[0,w.required],decimals:[2],numberFormat:[Mt.default,w.required],uom:[null],min:[null],max:[null],step:[null,w.compose([w.min(.001),w.max(1e4)])]}),this.stringPropertiesFormGroup=this.fb.group({identExpr:[null],stringlength:[null,w.required]}),this.selectPropertiesFormGroup=this.fb.group({optionModbus:[null,w.compose([w.required,this.uniqueKeyValidator.bind(this)])],optionMqtt:[null,w.compose([w.required,this.uniqueNameValidator.bind(this)])],deviceClass:[null]}),this.generateEntityCopyToForm(),this.specificationMethods&&(this.specificationSavedObservable=this.specificationMethods.getSaveObservable(),this.subSpec=this.specificationSavedObservable.subscribe(()=>{this.backupEntity=null,this.allFormGroups.markAsPristine();})),this.allFormGroups.setControl("entity",this.entityFormGroup),this.allFormGroups.setControl("variable",this.variableFormGroup);}ngOnDestroy(){this.subSpec&&this.subSpec.unsubscribe();}ngAfterViewInit(){this.converters=this.entityApiService.getConverters();}generateEntityCopyToForm(){this.entity?this.backupEntity=structuredClone(this.entity):(this.backupEntity=null,this.entity=structuredClone(this.entity)),this.copyEntityToForm(this.entity);}ngOnChanges(e){this.generateEntityCopyToForm();}findUom(e,i){return e&&e.uom&&e.defaultuom&&(!i||!e.uom.includes(i))?e.defaultuom:i;}getDeviceClass(e){return o.deviceClassesSensor.find(i=>i.name==e);}deviceClassHasUoms(){if(!this.numberPropertiesFormGroup||!this.numberPropertiesFormGroup.get("deviceClass"))return!1;let e=this.numberPropertiesFormGroup.get("deviceClass").value;return!!(e&&e.uom);}isVariableType(){let e=this.variableFormGroup.get(pe).value;return e&&e!=0&&Number.parseInt(e.value)!=0;}enableEntityFieldsVariableType(){let e=this.variableFormGroup.get(pe).value,i=[{form:this.entityFormGroup.get("name"),value:null},{form:this.entityFormGroup.get(fe),value:null},{form:this.entityFormGroup.get("icon"),value:null},{form:this.entityFormGroup.get("forceUpdate"),value:!1},{form:this.entityFormGroup.get("entityCategory"),value:null},{form:this.entityFormGroup.get("readonly"),value:!0}];this.isVariableType()?(i.forEach(t=>{t.form.disable(),t.form.setValue(t.value);}),dt(this.variableFormGroup.get(pe).value)?this.variableFormGroup.get(he).disable():this.variableFormGroup.get(he).enable()):(i.forEach(t=>t.form.enable()),this.variableFormGroup.get(he).setValue(null),this.variableFormGroup.get(he).disable()),this.entityFormGroup.updateValueAndValidity(),this.variableFormGroup.updateValueAndValidity();}copyEntityToForm(e){if(!this.entityFormGroup)return;let i=this.entityFormGroup.get("converter"),t=this.entityFormGroup.get("modbusAddress");if(this.disabled)this.entityFormGroup.disable(),this.numberPropertiesFormGroup.disable(),this.stringPropertiesFormGroup.disable(),this.variableFormGroup.disable(),this.selectPropertiesFormGroup.disable();else{this.entityFormGroup.enable(),this.numberPropertiesFormGroup.enable(),this.stringPropertiesFormGroup.enable(),this.variableFormGroup.enable(),this.selectPropertiesFormGroup.enable(),this.entityFormGroup.get(fe)?.setErrors(null);let a=this.entityFormGroup;this.enableEntityFieldsVariableType();}this.variableFormGroup.get(pe).setValue(e.variableConfiguration?e.variableConfiguration.targetParameter:null),this.variableFormGroup.get(he).setValue(e.variableConfiguration&&e.variableConfiguration.entityId?e.variableConfiguration.entityId:null),(this.variableFormGroup.get(pe).value==null||this.variableFormGroup.get(pe).value==0)&&(this.entityFormGroup.get(Fe).setValue(e.name),e.mqttname?this.entityFormGroup.get(fe).setValue(e.mqttname):this.entityFormGroup.get(fe).value!=null&&this.entityFormGroup.get(fe).setValue(Ge(this.entityFormGroup.get(Fe).value)),this.entityFormGroup.get("icon").setValue(e.icon),this.entityFormGroup.get("forceUpdate").setValue(e.forceUpdate),this.entityFormGroup.get("value_template").setValue(e.value_template),this.entityFormGroup.get("entityCategory").setValue(e.entityCategory),this.entityFormGroup.get("readonly").setValue(e.readonly)),this.entityFormGroup.get("registerType").setValue(this.getFunctionCode(e.registerType)),i.setValue(e.converter),t.setValue(e.modbusAddress!=null?e.modbusAddress:null),(i.value!==e.converter||t.value!==e.modbusAddress)&&(i.setValue(e.converter!==void 0?e.converter:null),t.setValue(e.modbusAddress&&e.modbusAddress!=-1?e.modbusAddress:null)),e.converterParameters||(e.converterParameters={});let r=e.converterParameters;switch(this.getParameterTypeFromConverterFormControl()){case"Inumber":this.allFormGroups.setControl("properties",this.numberPropertiesFormGroup);let a=r;this.numberPropertiesFormGroup.get("multiplier").setValue(a.multiplier?a.multiplier:1),this.numberPropertiesFormGroup.get("offset").setValue(a.offset?a.offset:0),this.numberPropertiesFormGroup.get("decimals").setValue(a.decimals!=null?a.decimals:-1);let m=this.getDeviceClass(a.device_class);this.numberPropertiesFormGroup.get("deviceClass").setValue(m||null),a.uom=this.findUom(m,a.uom),this.numberPropertiesFormGroup.get("uom").setValue(a.uom?a.uom:null),this.numberPropertiesFormGroup.get("stateClass").setValue(a.state_class?a.state_class:null),this.numberPropertiesFormGroup.get("numberFormat").setValue(a.numberFormat!==void 0?a.numberFormat:Mt.default),this.numberPropertiesFormGroup.get("min").setValue(a.identification&&a.identification.min!==void 0?a.identification.min:null),e.readonly||this.numberPropertiesFormGroup.get("step").setValue(a.step&&a.step!==void 0?a.step:null),this.numberPropertiesFormGroup.get("max").setValue(a.identification&&a.identification.max!==void 0?a.identification.max:null);break;case"Itext":this.allFormGroups.setControl("properties",this.stringPropertiesFormGroup);let u=r;this.stringPropertiesFormGroup.get("stringlength").setValue(u.stringlength?u.stringlength:10),this.stringPropertiesFormGroup.get("identExpr").setValue(u.identification?u.identification:null);break;case"Iselect":switch(this.allFormGroups.setControl("properties",this.selectPropertiesFormGroup),i.value){case"button":case"binary_sensor":let v=r;v.options=[{key:0,name:"ON"},{key:1,name:"OFF"}],this.selectPropertiesFormGroup.get("deviceClass").setValue(v.device_class?v.device_class:null);break;default:}}this.entity.valid=this.canSaveEntity();}getParameterTypeFromConverterFormControl(){let e=this.entityFormGroup.get("converter");return Ee(e.value);}getCurrentOptions(){return this.entity&&this.entity.converterParameters&&this.entity.converterParameters.options?this.entity.converterParameters.options:[];}getValueTemplate(){return this.entity.value_template?this.entity.value_template:"{{ value_json."+this.entity.mqttname+"}}";}isTouched(){if(!this.entityFormGroup.pristine||!this.variableFormGroup.pristine)return!0;switch(this.getParameterTypeFromConverterFormControl()){case"Iselect":if(!this.backupEntity)return!0;let e=JSON.stringify(this.entity.converterParameters.options),i=JSON.stringify(this.backupEntity.converterParameters.options);return e!=i;case"Itext":return!this.stringPropertiesFormGroup.pristine;case"Inumber":return!this.numberPropertiesFormGroup.pristine;default:return!1;}}readFromModbus(){this.specificationMethods.postModbusEntity(this.entity).subscribe(e=>{this.mqttValueObservable.next(e);});}isCurrentMessage(){return this.specificationMethods==null?!1:this.specificationMethods.getCurrentMessage()?.referencedEntity==this.entity.id;}onVariableEntityValueChange(){this.specificationMethods.setEntitiesTouched();let e=this.variableFormGroup.get(pe).value;e?this.entity.variableConfiguration={targetParameter:e,entityId:this.variableFormGroup.get(he).value==null?void 0:this.variableFormGroup.get(he).value}:this.entity.variableConfiguration&&delete this.entity.variableConfiguration,this.entity.name=void 0,this.enableEntityFieldsVariableType(),this.specificationMethods.copy2Translation(this.entity);}onEntityNameValueChange(){if(this.entity)if(this.specificationMethods.setEntitiesTouched(),this.isVariableType())this.onVariableEntityValueChange();else{delete this.entity.variableConfiguration,this.onVariableEntityValueChange(),this.entityFormGroup.get(Fe).value!=null&&this.entityFormGroup.get(Fe).value!="N/A"&&(this.entity.name=this.entityFormGroup.get(Fe).value);let e=this.entityFormGroup.get(fe).value;e&&e.length>0?this.entity.mqttname=e.toLowerCase():this.entity.name&&(this.entity.mqttname=Ge(this.entity.name)),this.entityFormGroup.get(fe).setValue(this.entity.mqttname!=null?this.entity.mqttname:null),this.enableEntityFieldsVariableType(),this.specificationMethods.copy2Translation(this.entity);}}onModbusAddressChange(){if(!this.entity)return;this.specificationMethods.setEntitiesTouched();let e=this.entityFormGroup.get("modbusAddress"),i=this.entityFormGroup.get("converter");(e.value!=null&&e.value!==this.entity.modbusAddress||i.value!=null&&i.value!==this.entity.converter)&&(this.entity.modbusAddress=e.value!=null?e.value:void 0,i.value!==null&&(this.entity.converter=i.value)),this.entity.registerType=this.entityFormGroup.get("registerType").value!=null?this.entityFormGroup.get("registerType").value.registerType:this.entity.registerType=A.HoldingRegister,this.entity.registerType==A.AnalogInputs?(this.entityFormGroup.get("registerType"),this.entity.readonly=!0,this.entityFormGroup.get("readonly")?.disable(),this.entityFormGroup.get("readonly")?.setValue(!0)):this.entityFormGroup.get("readonly")?.enable(),this.entity.readonly=!0,this.readFromModbus();}isAnalogInput(){return this.entity.registerType==A.AnalogInputs;}form2Entity(){if(this.entity){switch(this.specificationMethods.setEntitiesTouched(),this.entityFormGroup.get("icon").value!=null&&(this.entity.icon=this.entityFormGroup.get("icon").value),this.entityFormGroup.get("forceUpdate").value!=null&&(this.entity.forceUpdate=this.entityFormGroup.get("forceUpdate").value),this.entityFormGroup.get("value_template").value!=null&&(this.entity.value_template=this.entityFormGroup.get("value_template").value),this.entityFormGroup.get("readonly").value!=null&&(this.entity.readonly=this.entityFormGroup.get("readonly").value),this.entityFormGroup.get("entityCategory").value!=null&&this.entityFormGroup.get("entityCategory").value.length>0?this.entity.entityCategory=this.entityFormGroup.get("entityCategory").value:delete this.entity.entityCategory,this.getParameterTypeFromConverterFormControl()){case"Inumber":break;}this.setEntitiesTouched();}}onConverterValueChange(){this.onConverterValueChangeLocal(),this.readFromModbus();}updateReadonly(){switch(this.entityFormGroup.get("entityCategory").value){case"diagnostic":this.entityFormGroup.get("readonly").setValue(!0);break;case"config":this.entityFormGroup.get("readonly").setValue(!1);break;default:break;}}updateCategory(){let e=this.entityFormGroup.get("entityCategory").value;e&&e.length&&(e=this.entityFormGroup.get("readonly").value?"diagnostic":"config",this.entityFormGroup.get("entityCategory").setValue(e));}onConverterValueChangeLocal(){switch(this.specificationMethods.setEntitiesTouched(),this.getParameterTypeFromConverterFormControl()){case"Inumber":this.allFormGroups.setControl("properties",this.numberPropertiesFormGroup),this.entity.converterParameters={};let e=this.entity.converterParameters;this.numberPropertiesFormGroup.get("multiplier").value!=null?e.multiplier=this.numberPropertiesFormGroup.get("multiplier").value:e.multiplier=1,this.numberPropertiesFormGroup.get("offset").value!=null?e.offset=this.numberPropertiesFormGroup.get("offset").value:e.offset=0,this.numberPropertiesFormGroup.get("decimals").value!=null?e.decimals=this.numberPropertiesFormGroup.get("decimals").value:e.decimals=2,this.numberPropertiesFormGroup.get("numberFormat").value!=null&&(e.numberFormat=this.numberPropertiesFormGroup.get("numberFormat").value);let i=this.numberPropertiesFormGroup.get("min").value,t=this.numberPropertiesFormGroup.get("max").value;if(!this.entity.readonly){let v=this.numberPropertiesFormGroup.get("step").value;v&&(e.step=Number.parseFloat(v));}i!==null&&t!==null&&(e.identification={min:i,max:t}),this.numberPropertiesFormGroup.get("deviceClass").value!=null&&(e.device_class=this.numberPropertiesFormGroup.get("deviceClass").value.name),this.numberPropertiesFormGroup.get("stateClass").value!=null&&(e.state_class=this.numberPropertiesFormGroup.get("stateClass").value);let r=o.deviceClassesSensor.find(v=>v.name==e.device_class),a=this.numberPropertiesFormGroup.get("uom").value!=null?this.numberPropertiesFormGroup.get("uom").value:void 0,m=this.findUom(r,a);m&&(e.uom=m,this.numberPropertiesFormGroup.get("uom").setValue(m||null));break;case"Itext":this.allFormGroups.setControl("properties",this.stringPropertiesFormGroup),this.entity.converterParameters={};let u=this.stringPropertiesFormGroup.get("stringlength");u&&u.value!=null&&(this.entity.converterParameters.stringlength=u.value),this.stringPropertiesFormGroup.get("identExpr")!==null&&(this.entity.converterParameters.identification=this.stringPropertiesFormGroup.get("identExpr").value);break;case"Iselect":this.allFormGroups.setControl("properties",this.selectPropertiesFormGroup),this.entity.converterParameters||(this.entity.converterParameters={options:[]});break;}}onSaveEntity(){this.form2Entity(),this.entity&&(delete this.entity.isNew,this.onConverterValueChange());}canSaveEntity(){if(!this.entity)return!1;let e=this.entityFormGroup,i=!1;switch(this.getParameterTypeFromConverterFormControl()){case"Inumber":i=this.numberPropertiesFormGroup.valid;break;case"Iselect":this.entity&&this.entity.converterParameters&&this.entity.converterParameters.options&&(i=this.entity.converterParameters.options.length>0);break;case"Itext":i=this.stringPropertiesFormGroup.valid;break;default:i=!0;}return i&&e.valid&&this.variableFormGroup.valid;}restoreEntity(){this.backupEntity?(this.entity=this.backupEntity,this.copyEntityToForm(this.entity),this.entityFormGroup.markAsPristine()):this.entity=Bt;}addEntity(){this.specificationMethods.addEntity(this.entity),this.entity=structuredClone(Bt),this.copyEntityToForm(this.entity);}isNewEntity(e){return e.id==-1;}copyEntity(){this.specificationMethods.addEntity(this.entity);}isUniqueEntityName(e,i,t){return!e.find(a=>a.name===i.value&&(t==null||t.value.findIndex(m=>m.name===i.value)==-1));}createUniqueNameValidator(e,i,t){return r=>this.isUniqueEntityName(i(),e,t)?null:{unique:!0};}getIdentifiedIcon(e){switch(e.identified){case ee.identified:return"check";case ee.notIdentified:return"cancel";default:return"";}}getIdentifiedText(e){switch(e.identified){case ee.identified:return"modbus value matches with configuration";case ee.notIdentified:return"modbus value does NOT match with configuration";default:return"";}}isConverterSelected(){return this.entityFormGroup.get("converter").value!=null;}getMqttValue(e){return e?e.converter.name==="number"&&e.mqttValue!=null?e.mqttValue.toString():e.mqttValue:"N/A";}getModbusValue(e){return e&&e.modbusValue?e.modbusValue.toString():"N/A";}getDeviceClasses(){return this.getParameterTypeFromConverterFormControl()?this.getParameterTypeFromConverterFormControl()==="Ibinary_sensor"||this.getParameterTypeFromConverterFormControl()==="Iselect"?o.deviceClassesBinarySensor:o.deviceClassesSensor:[];}compareIConverters(e,i){return e!=null&&i!=null&&e.name===i.name;}compareFunctionCodes(e,i){return e&&i&&e.registerType==i.registerType;}compareNumber(e,i){return e==i;}compareName(e,i){return e&&i&&e.name==i.name;}compareEntities(e,i){return e&&i&&e.id==i.id;}getEntityLabel(){if(!this.entity.name&&this.isVariableType()){let e=this.variableTypes.find(i=>i.id==this.entity.variableConfiguration.targetParameter);if(!dt(this.entity.variableConfiguration.targetParameter)){let i=this.specificationMethods.getNonVariableNumberEntities().find(t=>t.id==this.entity.variableConfiguration.entityId);return i?"=>"+i.name:"";}}return"";}getNonVariableNumberEntities(){return[{id:4,name:"ent 4"}];}getVariableTypeOrEntityNameLabel(){if(this.entity.name)return this.entity.name;if(this.isVariableType()){let e=this.variableTypes.find(i=>i.id==this.entity.variableConfiguration.targetParameter);return e?e.name:"";}return"";}getFunctionCode(e){let i;return e&&(i=this.registerTypes.find(t=>t.registerType==e)),i||this.registerTypes[0];}addOption(){if(this.canAddOption()){this.specificationMethods.setEntitiesTouched();let e=this.selectPropertiesFormGroup;if(this.selectPropertiesFormGroup.valid&&this.entity){this.entity.converterParameters.options==null&&(this.entity.converterParameters.options=[]);let i;if(i=e.get(Pr).value,i!=null&&i!=null){let t=this.entity.converterParameters.options.findIndex(r=>r.key>i);t>=0?this.entity.converterParameters.options.splice(t,0,{key:i,name:e.get(vn).value}):this.entity.converterParameters.options.push({key:i,name:e.get(vn).value}),this.readFromModbus();}this.entity=structuredClone(this.entity);}}}setEntitiesTouched(){this.specificationMethods.setEntitiesTouched();}dropOptions(e){De(this.entity.converterParameters.options,e.previousIndex,e.currentIndex),this.specificationMethods.setEntitiesTouched();}canAddOption(){return this.selectPropertiesFormGroup.get(["optionModbus"])?.updateValueAndValidity(),this.selectPropertiesFormGroup.get(["optionMqtt"])?.updateValueAndValidity(),this.selectPropertiesFormGroup.valid;}deleteOption(e){this.specificationMethods.setEntitiesTouched();let i=this.getCurrentOptions().findIndex(t=>t.key==e.key);i>=0&&this.getCurrentOptions().splice(i,1),this.entity&&(this.entity.modbusValue[0]==e.key?this.readFromModbus():this.copyEntityToForm(this.entity),this.allFormGroups.markAsDirty());}static{this.deviceClassesSensor=[{name:"None"},{name:"apparent_power",defaultuom:"VA",uom:["VA"]},{name:"atmospheric_pressure",defaultuom:"mbar",uom:["cbar","bar","hPa","mmHg","inHg","kPa","mbar","Pa","psi"]},{name:"current",defaultuom:"A",uom:["A","mA"]},{name:"data_rate",defaultuom:"MB/s",uom:["bit/s","kbit/s","Mbit/s","Gbit/s","B/s","kB/s","MB/s","GB/s","KiB/s","MiB/s","GiB/s"]},{name:"data_size",defaultuom:"GB",uom:["bit","kbit","Mbit","Gbit","B","kB","MB","GB","TB","PB","EB","ZB","YB","KiB","MiB","GiB","TiB","PiB"]},{name:"date"},{name:"distance",defaultuom:"m",uom:["km","m","cm","mm","mi","nmi","yd","in"]},{name:"duration",defaultuom:"s",uom:["d","h","min","s","ms"]},{name:"energy",defaultuom:"kWh",uom:["J","kJ","MJ","GJ","Wh","kWh","MWh","cal","kcal","Mcal","Gcal"]},{name:"energy_storage",defaultuom:"kWh",uom:["J","kJ","MJ","GJ","Wh","kWh","MWh","cal","kcal","Mcal","Gcal"]},{name:"enum"},{name:"frequency",defaultuom:"Hz",uom:["Hz","kHz","MHz","GHz"]},{name:"gas",defaultuom:"m\xB3",uom:["m\xB3","ft\xB3","CCF"]},{name:"humidity",defaultuom:"%",uom:["%"]},{name:"pm1",defaultuom:"\xB5g/m\xB3",uom:["\xB5g/m\xB3"]},{name:"pm25",defaultuom:"\xB5g/m\xB3",uom:["\xB5g/m\xB3"]},{name:"pm10",defaultuom:"\xB5g/m\xB3",uom:["\xB5g/m\xB3"]},{name:"power_factor",defaultuom:"%\xB3",uom:["%"]},{name:"power",defaultuom:"W",uom:["W","kW"]},{name:"precipitation",defaultuom:"cm",uom:["cm","mm"]},{name:"precipitation_intensity",defaultuom:"mm/h",uom:["in/d","in/h","mm/d","mm/h"]},{name:"pressure",defaultuom:"mbar",uom:["Pa","kPa","hPa","bar","cbar","mbar","mmHg","inHg","psi"]},{name:"reactive_power",defaultuom:"var",uom:["var"]},{name:"signal_strength",defaultuom:"bB",uom:["dB","dBm"]},{name:"speed",defaultuom:"m/s",uom:["ft/s","in/d","in/h","in/s","km/h","kn","m/s","mph","mm/d","mm/s"]},{name:"temperature",defaultuom:"\xB0C",uom:["\xB0C","\xB0F","K"]},{name:"timestamp"},{name:"voltage",defaultuom:"V",uom:["V","mV"]},{name:"volume",defaultuom:"m\xB3",uom:["L","mL","gal","fl. oz.","m\xB3","ft\xB3","CCF"]},{name:"volume_storage",defaultuom:"m\xB3",uom:["L","mL","gal","fl. oz.","m\xB3","ft\xB3","CCF"]},{name:"water",defaultuom:"m\xB3",uom:["L","gal","m\xB3","ft\xB3","CCF"]},{name:"weight",defaultuom:"kg",uom:["kg","g","mg","\xB5g","oz","lb","st"]}];}static{this.ɵfac=function(i){return new(i||o)(F(te),F(se));};}static{this.ɵcmp=G({type:o,selectors:[["app-entity"]],inputs:{specificationMethods:"specificationMethods",entity:"entity",disabled:"disabled"},features:[He,J],decls:81,vars:42,consts:[["entityName",""],["entityMqttName",""],["entityIcon",""],["entityModbusAddress",""],["entityFunctionCode",""],["propMultiplier",""],["propOffset",""],["propNumChar",""],["propRegex",""],["propOptionModbus",""],["propOptionMqtt",""],[1,"card"],[1,"card-header-buttons"],[4,"ngIf"],[3,"ngClass"],[1,"icon-display",3,"color"],[3,"entity","specificationMethods","mqttValueObservable"],[3,"matTooltip"],[3,"formGroup"],[1,"flexcols"],[1,"smallfield"],["matInput","","type","text","formControlName","name",1,"width150pt",3,"change","errorStateMatcher"],[1,"flexrows"],["matInput","","type","text","formControlName","mqttname",1,"width150pt",3,"keypress","change","errorStateMatcher"],["matInput","","type","text","formControlName","icon",1,"width150pt",3,"change"],[1,"width100pt","smallfield"],["matInput","","type","number","formControlName","modbusAddress",3,"change","errorStateMatcher"],["matInput","","formControlName","registerType",3,"selectionChange","errorStateMatcher","compareWith"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","converter",3,"selectionChange","compareWith"],["formControlName","forceUpdate","matTooltip","Update Home Assistant history even if value hasn't changed",1,"width50","toggleField",3,"change"],["formControlName","readonly","matTooltip","The Modbus Value is read only",1,"width50","toggleField",3,"change"],[1,"smallfield","width150pt"],["matInput","","formControlName","entityCategory","matTooltip",`Classification of a non-primary entity. 
                            Set to config for an entity that allows changing the configuration of a device, 
                            for example, a switch entity, making it possible to turn the background illumination of a switch on and off. 
                            Set to diagnostic for an entity exposing some configuration parameter or diagnostics of a device but does 
                            not allow changing it, for example, a sensor showing RSSI or MAC address.`,3,"selectionChange"],["matInput","","formControlName","value_template",3,"change","placeholder"],["type","button","mat-icon-button","","matTooltip","Add this Entity","color","primary",1,"material-icons","app-toolbar-menu","save-button",3,"click"],["type","button","mat-icon-button","","matTooltip","Delete this Entity","color","warn",1,"material-icons","app-toolbar-menu","delete-button",3,"click"],["mat-icon-button","","matTooltip","Restore original Entity","color","primary",1,"material-icons","app-toolbar-menu","save-button",3,"click"],["type","button","mat-icon-button","","matTooltip","Add this Entity","color","warn",1,"material-icons","app-toolbar-menu","cancel-button",3,"click","disabled"],[3,"value"],["matInput","","formControlName","deviceClass",3,"selectionChange","compareWith"],[1,"smallfield","width100pt"],["matInput","","type","text","formControlName","uom",3,"change",4,"ngIf"],["matInput","","formControlName","uom",3,"selectionChange",4,"ngIf"],["matInput","","formControlName","stateClass",3,"selectionChange","errorStateMatcher","compareWith"],["matInput","","type","number","formControlName","multiplier",3,"change"],[1,"smallfield","width80pt"],["matInput","","type","number","formControlName","offset",3,"change"],[1,"smallfield","width130pt"],["matInput","","formControlName","numberFormat",3,"selectionChange","errorStateMatcher","compareWith"],["matInput","","formControlName","decimals",3,"selectionChange","compareWith"],["matInput","","type","number","matTooltip","Optional: The entity is identified if the mqttvalue is between min and max.","formControlName","min",3,"change"],["appearance","fill",1,"smallfield","width100pt"],["matInput","","type","number","matTooltip","Optional: The entity is identified if the mqttvalue is between min and max.","formControlName","max",3,"change"],["appearance","fill","class","smallfield  width100pt",4,"ngIf"],["matInput","","type","text","formControlName","uom",3,"change"],["matInput","","formControlName","uom",3,"selectionChange"],["matInput","","type","number","matTooltip","Optional: increase/decrease step of input field for Discovery.","formControlName","step",3,"change"],["matInput","","type","number","formControlName","stringlength",3,"change"],["matInput","","type","text","matTooltip","Optional: The entity is identified if the mqttvalue matches the regular expression","formControlName","identExpr",3,"change"],["cdkDropList","",1,"flexcols",3,"cdkDropListDropped"],["cdkDrag","",4,"ngFor","ngForOf"],["matInput","","type","number","formControlName","optionModbus",1,"center",3,"keyup.enter"],["matInput","","type","text","formControlName","optionMqtt",1,"center",3,"keyup.enter"],["type","button","mat-icon-button","","matTooltip","Add","color","primary",1,"material-icons","app-toolbar-menu","add-button",3,"click","disabled"],["class","smallfield",4,"ngIf"],["cdkDrag",""],[1,"inline","width150pt"],[1,"inline","width200pt"],[1,"inline"],["type","button","mat-icon-button","","class","material-icons app-toolbar-menu delete-button","matTooltip","Delete","color","warn",3,"click",4,"ngIf"],["type","button","mat-icon-button","","matTooltip","Delete","color","warn",1,"material-icons","app-toolbar-menu","delete-button",3,"click"],["matInput","","formControlName","deviceClass"],["matInput","","type","number","formControlName","variableType",3,"selectionChange","compareWith"],["matInput","","formControlName","variableEntity",3,"selectionChange","compareWith","errorStateMatcher"]],template:function(i,t){if(i&1){let r=C();l(0,"mat-card",11)(1,"mat-card-header")(2,"mat-card-title")(3,"div")(4,"div",12),y(5,Kn,8,1,"ng-container",13)(6,Zn,4,1,"ng-container",13),s()(),l(7,"span",14),d(8),y(9,Yn,1,0,"br",13),d(10),s(),l(11,"mat-icon",15),d(12),s(),k(13,"app-entity-value-control",16),s()(),l(14,"mat-card-content")(15,"mat-expansion-panel")(16,"mat-expansion-panel-header")(17,"mat-panel-title",17)(18,"p",14),d(19,"Entity"),s()()(),l(20,"form",18)(21,"div",19)(22,"mat-form-field",20)(23,"mat-label"),d(24),s(),l(25,"input",21,0),h("change",function(){return g(r),_(t.onEntityNameValueChange());}),s(),y(27,Qn,2,0,"mat-error",13),s(),l(28,"div",22)(29,"mat-form-field",20)(30,"mat-label"),d(31,"MQTT ID"),s(),l(32,"input",23,1),h("keypress",function(m){return g(r),_(t.onMqttKeyPress(m));})("change",function(){return g(r),_(t.onEntityNameValueChange());}),s(),y(34,Jn,2,0,"mat-error",13)(35,Xn,2,0,"mat-error",13),s(),l(36,"mat-form-field",20)(37,"mat-label"),d(38,"Icon"),s(),l(39,"input",24,2),h("change",function(){return g(r),_(t.form2Entity());}),s()()(),l(41,"div",22)(42,"mat-form-field",25)(43,"mat-label"),d(44,"Modbus Addr."),s(),l(45,"input",26,3),h("change",function(){return g(r),_(t.onModbusAddressChange());}),s(),y(47,er,2,0,"mat-error",13)(48,tr,2,0,"mat-error",13),s(),l(49,"mat-form-field",20)(50,"mat-label"),d(51,"Register"),s(),l(52,"mat-select",27,4),h("selectionChange",function(){return g(r),_(t.onModbusAddressChange());}),y(54,ir,2,2,"mat-option",28),s(),y(55,nr,2,0,"mat-error",13),s()(),l(56,"mat-form-field",20)(57,"mat-label"),d(58,"Converter"),s(),l(59,"mat-select",29),h("selectionChange",function(){return g(r),_(t.onModbusAddressChange());}),y(60,rr,2,2,"mat-option",28),si(61,"async"),s()()(),l(62,"div",22)(63,"mat-slide-toggle",30),h("change",function(){return g(r),_(t.form2Entity());})("change",function(){return g(r),_(t.form2Entity());}),d(64,"Force Updates"),s(),l(65,"mat-slide-toggle",31),h("change",function(){return g(r),t.form2Entity(),_(t.updateCategory());}),d(66,"Read Only"),s(),l(67,"mat-form-field",32)(68,"mat-label"),d(69,"Category"),s(),l(70,"mat-select",33),h("selectionChange",function(){return g(r),t.form2Entity(),_(t.updateReadonly());}),y(71,or,2,2,"mat-option",28),s()()(),l(72,"div",19)(73,"mat-form-field",20)(74,"mat-label"),d(75,"Value Template"),s(),l(76,"input",34),h("change",function(){return g(r),_(t.form2Entity());}),s()()()()(),y(77,hr,85,34,"mat-expansion-panel",13)(78,gr,17,6,"mat-expansion-panel",13)(79,wr,22,9,"mat-expansion-panel",13)(80,Ir,31,20,"mat-expansion-panel",13),s()();}if(i&2){let r,a,m;c(5),p("ngIf",t.entity.id!=-1),c(),p("ngIf",t.entity.id==-1),c(),p("ngClass",L(37,Ae,t.isCurrentMessage())),c(),M(t.getVariableTypeOrEntityNameLabel()),c(),p("ngIf",t.entity.name==null),c(),M(t.getEntityLabel()),c(),p("color",t.entity.identified==1?"primary":t.entity.identified==-1?"":"warn"),c(),x(" ",t.entity.identified==null||t.entity.identified==-1?"thumbs_up_down":t.entity.identified==1?"thumb_up":"thumb_down",""),c(),p("entity",t.entity)("specificationMethods",t.specificationMethods)("mqttValueObservable",t.mqttValueObservable),c(4),p("matTooltip",t.entityFormGroup.valid||t.isNewEntity(t.entity)?"":"This panel has errors"),c(),p("ngClass",L(39,Ae,!t.entityFormGroup.valid&&!t.isNewEntity(t.entity))),c(2),p("formGroup",t.entityFormGroup),c(4),x("Name(",(t.specificationMethods?t.specificationMethods.getMqttLanguageName():"")+(t.entity.id>=0?","+t.entity.id:""),")"),c(),p("errorStateMatcher",t.errorStateMatcher),c(2),p("ngIf",((r=t.entityFormGroup.get("name"))==null?null:r.hasError("required"))!=null),c(5),p("errorStateMatcher",t.errorStateMatcher),c(2),p("ngIf",((a=t.entityFormGroup.get("mqttname"))==null?null:a.hasError("unique"))!=null),c(),p("ngIf",((m=t.entityFormGroup.get("mqttname"))==null?null:m.hasError("required"))!=null),c(10),p("errorStateMatcher",t.errorStateMatcher),c(2),p("ngIf",t.entityFormGroup.get("modbusAddress").hasError("required")),c(),p("ngIf",t.entityFormGroup.get("modbusAddress").hasError("min")||t.entityFormGroup.get("modbusAddress").hasError("max")),c(4),p("errorStateMatcher",t.errorStateMatcher)("compareWith",t.compareFunctionCodes),c(2),p("ngForOf",t.registerTypes),c(),p("ngIf",t.entityFormGroup.get("registerType").hasError("required")),c(4),p("compareWith",t.compareIConverters),c(),p("ngForOf",li(61,35,t.converters)),c(11),p("ngForOf",t.entityCategories),c(5),p("placeholder",t.getValueTemplate()),c(),p("ngIf",t.isConverterSelected()&&t.entity&&t.getParameterTypeFromConverterFormControl()=="Inumber"),c(),p("ngIf",t.isConverterSelected()&&t.entity&&t.getParameterTypeFromConverterFormControl()=="Itext"),c(),p("ngIf",t.isConverterSelected()&&t.entity&&t.getParameterTypeFromConverterFormControl()=="Iselect"),c(),p("ngIf",!ve(41,Wn).includes(t.entity.converter.name));}},dependencies:[et,nt,tt,B,Se,Ce,be,ye,_n,it,le,ce,me,$,re,W,Xe,j,ie,K,oe,ae,z,H,Z,Ke,xe,rt,U,$e,gn,fn,pi],styles:[".mat-mdc-card-header[_ngcontent-%COMP%]{font-weight:700;background-color:#fddbe0;display:flex}"]});}}return o;})();var Mr=o=>({errorText:o});function Nr(o,n){if(o&1){let e=C();l(0,"mat-form-field")(1,"textarea",10),h("input",function(t){g(e);let r=f(3);return _(r.translatedValuesPasted(t));}),s()();}}function kr(o,n){if(o&1){let e=C();P(0),l(1,"button",9),h("click",function(){g(e);let t=f(2);return _(t.googleTranslate());}),d(2),s(),y(3,Nr,2,0,"mat-form-field",0),V();}if(o&2){let e=f(2);c(2),x("Google Translate",e.supportsGoogleTranslate?"":" URL",""),c(),p("ngIf",!e.supportsGoogleTranslate);}}function Rr(o,n){if(o&1){let e=C();P(0),l(1,"mat-form-field",12)(2,"mat-label"),d(3),s(),l(4,"input",11),h("change",function(){let t=g(e).$implicit,r=f(3);return _(r.changeText(t));}),s()(),V();}if(o&2){let e=n.$implicit,i=f(3);c(3),M(i.getOriginalText(e)),c(),p("formControlName",e);}}function Gr(o,n){if(o&1){let e=C();P(0),l(1,"mat-form-field",2)(2,"mat-label"),d(3),s(),l(4,"input",11),h("change",function(){let t=g(e).$implicit,r=f(2);return _(r.changeText(t));}),s()(),y(5,Rr,5,2,"ng-container",8),V();}if(o&2){let e=n.$implicit,i=f(2);c(3),Tt("",i.getOriginalText(e),"(",i.getLanguageName(i.translationLanguage),")"),c(),p("formControlName",e),c(),p("ngForOf",i.getOptionKeys(e));}}function Or(o,n){if(o&1){let e=C();l(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"p",1),d(4),s()()(),l(5,"div",2)(6,"mat-slide-toggle",3),h("change",function(){g(e);let t=f();return _(t.onLanguageToggle());}),d(7),s(),l(8,"form",4),y(9,kr,4,2,"ng-container",0),l(10,"div",5)(11,"h2"),d(12,"Specification"),s(),l(13,"mat-form-field",2)(14,"mat-label"),d(15),s(),l(16,"input",6),h("change",function(){g(e);let t=f();return _(t.changeText("name"));}),s()(),l(17,"h2"),d(18,"Entities"),s(),l(19,"div",7),y(20,Gr,6,4,"ng-container",8),s()()()()();}if(o&2){let e=f();c(3),p("ngClass",L(8,Mr,!e.translationFormGroup.valid)),c(),x(" Translation(",e.getLanguageName(e.translationLanguage),")"),c(3),x(" Switch Languages: ",e.getLanguageName(e.originalLanguage)+"->"+e.getLanguageName(e.translationLanguage),""),c(),p("formGroup",e.translationFormGroup),c(),p("ngIf",!e.translationFormGroup.valid),c(6),Tt("",e.getOriginalText("name"),"(",e.getLanguageName(e.translationLanguage),")"),c(5),p("ngForOf",e.getAllKeys());}}var bn=(()=>{class o{constructor(e,i,t){this.entityApiService=e,this.fb=i,this.router=t,this.specificationSubscription=void 0,this.updateI18n=new T(),this.languageToggle=!1,this.supportsGoogleTranslate=!0,this.allKeys=[],this.originalLanguages=[],this.translatedLanguages=[],this.translationFormGroupInitialized=!1,this.googleTranslateWindow=null,this.translationFormGroup=new Pi({});}ngOnInit(){this.mqttdiscoverylanguage!="en"&&this.specificationFormGroup.setControl("translation",this.translationFormGroup),this.translationFormGroup.addControl("name",new ne(null)),this.specificationSubscription=this.specificationObservable.subscribe(e=>{if(e&&(this.currentSpecification=e),this.mqttdiscoverylanguage!="en"){let i=this.currentSpecification.i18n.find(r=>r.lang==this.mqttdiscoverylanguage);this.currentSpecification.i18n.find(r=>r.lang=="en")?this.languageToggle=i!=null:this.languageToggle=!0;}this.reloadTexts();});}onLanguageToggle(){this.languageToggle=!this.languageToggle,this.reloadTexts();}addOrUpdateControl(e){let i=Ye(this.currentSpecification,this.translationLanguage,e,!0),t=this.translationFormGroup.get(e);t?t.setValue(i):this.translationFormGroup.setControl(e,new ne(i,w.required));}reloadTexts(){this.languageToggle?(this.originalLanguage=this.mqttdiscoverylanguage,this.translationLanguage="en"):(this.originalLanguage="en",this.translationLanguage=this.mqttdiscoverylanguage),this.addOrUpdateControl("name"),this.fillLanguages();for(let e of this.getAllKeys()){try{this.addOrUpdateControl(e);let i=this.getOptionKeys(e);i.forEach(t=>{this.addOrUpdateControl(t);});for(let t in this.translationFormGroup.controls)t.startsWith(e)&&t!=e&&!i.includes(t)&&this.translationFormGroup.removeControl(t);}catch{}this.translationFormGroup.updateValueAndValidity(),this.translationFormGroupInitialized=!0;}}getLanguageName(e){return Q.getLanguageName(e);}showTranslation(){if(this.currentSpecification.i18n.find(i=>i.lang=="en")==null)return!0;let e=[];return this.currentSpecification.i18n.find(i=>i.lang==this.mqttdiscoverylanguage)==null?!0:(Di(this.currentSpecification,this.mqttdiscoverylanguage,e),e.length>0);}fillLanguages(){this.originalLanguages=[],this.translatedLanguages=[],this.currentSpecification.i18n.forEach(e=>{this.originalLanguages.push(e.lang);});}ngOnDestroy(){this.specificationSubscription&&this.specificationSubscription.unsubscribe();}getKeyType(e){return e=="name"?"Spec":"Entity";}getOriginalText(e){return Ye(this.currentSpecification,this.originalLanguage,e,!0);}changeText(e){let i=this.translationFormGroup.get(e);if(i){let t=i.value;Ei(this.currentSpecification,this.translationLanguage,e,t),this.translationFormGroup.updateValueAndValidity(),this.updateI18n.emit({key:e,i18n:this.currentSpecification.i18n});}}translatedText(e){return Ye(this.currentSpecification,this.translationLanguage,e,!0);}getAllKeys(){let e=[];return this.currentSpecification&&this.currentSpecification.entities.forEach(i=>{(!i.variableConfiguration||i.variableConfiguration.targetParameter<=D.deviceIdentifiers)&&e.push("e"+i.id);}),e;}errorHandler(e){return e.status==406?(this.supportsGoogleTranslate=!1,this.googleTranslate(),!0):!1;}translatedValuesPasted(e){if(e&&e.target){let i=e.target.value;if(i){let t=i.split(`
`);this.copyTranslations2Form(t),e.target.value="";}}}needsTranslation(){return this.generateTranslationTexts(),this.ids.length>0;}copyTranslations2Form(e){let i=structuredClone(this.ids),t=e.pop(),r=i.pop();for(;t&&r;){let a;(a=this.translationFormGroup.get([r]))!=null&&(a.setValue(t),this.changeText(r)),t=e.pop(),r=i.pop();}}generateTranslationTexts(){if(this.ids=[],this.textBuffer=[],this.currentSpecification&&this.currentSpecification.i18n){let e=this.currentSpecification.i18n.find(r=>r.lang==this.originalLanguage),i=this.currentSpecification.i18n.find(r=>r.lang==this.translationLanguage),t=[];e&&e.texts&&e.texts.forEach(r=>{(i==null||i.texts.find(a=>a.textId==r.textId)==null)&&(this.textBuffer.push(r.text),this.ids.push(r.textId));});}}googleTranslate(){if(this.generateTranslationTexts(),this.ids.length){if(this.supportsGoogleTranslate)this.entityApiService.postTranslate(this.originalLanguage,this.translationLanguage,this.textBuffer,this.errorHandler.bind(this)).subscribe(this.copyTranslations2Form);else if(this.textBuffer.length){let e=`https://translate.google.com/?sl=${this.originalLanguage}&hl=${this.translationLanguage}&text=${this.textBuffer.join("%0A")}`;this.googleTranslateWindow=window.open(e,"modbus2mqttTranslation");}}}getOptionKeys(e){let i=parseInt(e.substring(1)),t=[];if(this.currentSpecification){let r=this.currentSpecification.entities.find(a=>a.id==i);if(r&&Ee(r.converter)=="Iselect"){let a=r.converterParameters.options,m=r.converterParameters.optionModbusValues;a&&a.length&&a.forEach(u=>t.push("e"+r.id+"o."+u.key)),m&&m.length&&m.forEach(u=>{let v="e"+r.id+"o."+u;t.includes(v)||t.push(v);});}}return t;}static{this.ɵfac=function(i){return new(i||o)(F(te),F(se),F(We));};}static{this.ɵcmp=G({type:o,selectors:[["app-translation"]],inputs:{specificationObservable:"specificationObservable",specificationFormGroup:"specificationFormGroup",mqttdiscoverylanguage:"mqttdiscoverylanguage",specificationMethods:"specificationMethods"},outputs:{updateI18n:"updateI18n"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngClass"],[1,"width300pt"],[1,"width50","toggleField",3,"change"],[3,"formGroup"],[1,"full-width","flexcolumns"],["matInput","","formControlName","name",1,"width250pt",3,"change"],[1,"scrollable","flexcolumns"],[4,"ngFor","ngForOf"],["mat-button","","type","button",3,"click","disabled"],["matInput","","placeholder","Paste Translated Texts here ","cdkTextareaAutosize","","cdkAutosizeMinRows","3",3,"input"],["matInput","",3,"change","formControlName"],[1,"width250pt","margin"]],template:function(i,t){i&1&&y(0,Or,21,10,"mat-expansion-panel",0),i&2&&p("ngIf",t.mqttdiscoverylanguage!="en");},dependencies:[B,le,ce,me,ye,xe,$,re,W,j,ie,K,oe,ae,Ci,z,Z,ki,H,U],styles:[".rightAligned[_ngcontent-%COMP%]{right:0;margin-left:auto;background-color:green}.scrollable[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.margin[_ngcontent-%COMP%]{padding-left:30px}"]});}}return o;})();var Cn=(()=>{class o{constructor(){this.fileDropped=new T();}onDragOver(e){e.preventDefault(),e.stopPropagation(),this.fileOver=!0;}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.fileOver=!1;}ondrop(e){e.preventDefault(),e.stopPropagation(),this.fileOver=!1,e.dataTransfer&&e.dataTransfer.files.length>0&&this.fileDropped.emit(e.dataTransfer.files);}static{this.ɵfac=function(i){return new(i||o)();};}static{this.ɵdir=Pe({type:o,selectors:[["","dragndropDirective",""]],hostVars:2,hostBindings:function(i,t){i&1&&h("dragover",function(a){return t.onDragOver(a);})("dragleave",function(a){return t.onDragLeave(a);})("drop",function(a){return t.ondrop(a);}),i&2&&Ve("fileover",t.fileOver);},outputs:{fileDropped:"fileDropped"}});}}return o;})();var Lr=["addImageUrlButton"],Ar=["addDocumentUrlButton"],Sn=o=>({errorText:o});function qr(o,n){if(o&1&&(l(0,"a",26),d(1),s()),o&2){let e=f();p("href",e.documentUrls[0].url,Be),c(),M(e.getBaseFilename(e.documentUrls[0].url));}}function Ur(o,n){o&1&&d(0," No Documenation available ");}function Br(o,n){if(o&1){let e=C();l(0,"button",28),h("click",function(){g(e);let t=f().$implicit,r=f();return _(r.deleteFile(t));}),l(1,"mat-icon"),d(2,"delete"),s()();}}function Hr(o,n){if(o&1){let e=C();l(0,"div",20),h("fileDropped",function(t){g(e);let r=f();return _(r.onDocumentationDropped(t));}),l(1,"a",26),d(2),s(),y(3,Br,3,0,"button",27),s();}if(o&2){let e=n.$implicit,i=f();c(),p("href",e.url,Be),c(),M(i.getBaseFilename(e.url)),c(),p("ngIf",i.currentSpecification!=null);}}function zr(o,n){if(o&1){let e=C();l(0,"button",31),h("fileDropped",function(t){g(e);let r=f(2);return _(r.onImageDropped(t));})("click",function(){g(e);let t=f().$implicit,r=f();return _(r.deleteFile(t));}),l(1,"mat-icon"),d(2,"delete"),s()();}}function Wr(o,n){if(o&1){let e=C();l(0,"div",29),h("fileDropped",function(t){g(e);let r=f();return _(r.onImageDropped(t));}),l(1,"a",26),d(2),s(),y(3,zr,3,0,"button",30),s();}if(o&2){let e=n.$implicit,i=f();c(),p("href",e.url,Be),c(),M(i.getBaseFilename(e.url)),c(),p("ngIf",i.currentSpecification!=null);}}var En=(()=>{class o{constructor(e,i){this.entityApiService=e,this.fb=i,this.updateDocumentation=new T(),this.galleryItems=[],this.imageUrls=[],this.documentUrls=[];}ngOnChanges(){this.generateDocumentUrls(),this.generateImageGalleryItems(),this.addImageUrlButton&&(this.addImageUrlButton.disabled=!0),this.addDocumentUrlButton&&(this.addDocumentUrlButton.disabled=!0);}ngOnInit(){this.uploadFilesForm=this.fb.group({urlDocument:[null],urlImage:[null]}),this.urlDocumentControl=this.uploadFilesForm.get("urlDocument"),this.urlImageControl=this.uploadFilesForm.get("urlImage"),this.generateDocumentUrls();}fileBrowseHandler(e,i){e&&e.files!==null&&(i=="doc"?this.onDocumentationDropped(e.files):this.onImageDropped(e.files));}imageBrowseHandler(e){this.fileBrowseHandler(e,"img");}documenationBrowseHandler(e){this.fileBrowseHandler(e,"doc");}getEventMessage(e){switch(e.type){case It.UploadProgress:break;case It.Response:return e.body;default:return`Upload event: ${e.type}.`;}}getBaseFilename(e){let i=e.lastIndexOf("/");return i>=0?e.substring(i+1):e;}onFileDropped(e,i){var t=new FormData();this.currentSpecification&&(Array.prototype.forEach.call(e,r=>{var a=this.currentSpecification.files;a.find(u=>u.url.endsWith(r.name)&&u.usage==i)||t.append("documents",r);}),this.entityApiService.postFile(this.currentSpecification.filename,i,t).subscribe(r=>{this.currentSpecification.files=r,i=="img"?this.generateImageGalleryItems():this.generateDocumentUrls(),this.updateDocumentation.next(r);}));}onImageDropped(e){this.onFileDropped(e,"img");}onDocumentationDropped(e){this.onFileDropped(e,"doc");}addDocument(e,i){let t=e.value;t&&this.currentSpecification&&(this.currentSpecification.files.find(a=>a.url==t)||this.entityApiService.postAddFilesUrl(this.currentSpecification.status==3?"_new":this.currentSpecification.filename,{url:t,fileLocation:Si.Global,usage:i}).subscribe(a=>{this.currentSpecification.files=a,i=="img"?this.generateImageGalleryItems():this.generateDocumentUrls(),this.updateDocumentation.next(a);}));}addDocumentUrl(){this.urlDocumentControl.updateValueAndValidity(),this.addDocument(this.urlDocumentControl,"doc");}addImageUrl(){this.urlImageControl.updateValueAndValidity(),this.addDocument(this.urlImageControl,"img");}enableAddButton(e,i){i.disabled=!e.target||e.target.value==null||e.target.value=="";}generateDocumentUrls(){let e=[];if(this.currentSpecification&&this.currentSpecification.files)for(let i=0;i<this.currentSpecification.files.length;i++){let t=this.currentSpecification.files[i];t.usage=="doc"&&e.push(t);}e.length!=this.documentUrls.length&&(this.documentUrls=e);}generateImageGalleryItems(){let e=[],i=[];this.currentSpecification?.files.forEach(t=>{t.usage=="img"&&(e.push(new qi({src:t.url,thumb:t.url})),i.push(t));}),this.imageUrls=i,this.galleryItems=e;}deleteFile(e){this.currentSpecification&&this.entityApiService.deleteUploadedFile(this.currentSpecification.filename,e.url,e.usage).subscribe(i=>{this.currentSpecification.files=i,e.usage=="img"?this.generateImageGalleryItems():this.generateDocumentUrls();});}static{this.ɵfac=function(i){return new(i||o)(F(te),F(se));};}static{this.ɵcmp=G({type:o,selectors:[["app-upload-files"]],viewQuery:function(i,t){if(i&1&&(Et(Lr,5),Et(Ar,5)),i&2){let r;xt(r=wt())&&(t.addImageUrlButton=r.first),xt(r=wt())&&(t.addDocumentUrlButton=r.first);}},inputs:{currentSpecification:[0,"specification","currentSpecification"]},outputs:{updateDocumentation:"updateDocumentation"},features:[J],decls:53,vars:17,consts:()=>{let e;e="Browse for Document Files";let i;return i="Browse for Image Files",[["noElements",""],["documents",""],["addDocumentUrlButton",""],["addImageUrlButton",""],e,i,[3,"formGroup"],["type","submit","hidden","hidden"],[3,"ngClass"],["dragndropDirective","",1,"flexcolumns",3,"fileDropped"],["class","nodistance clickable","target","_blank","rel","noopener noreferrer",3,"href",4,"ngIf","ngIfElse"],["dragndropDirective","",3,"fileDropped"],["class","bordervisible","dragndropDirective","",3,"fileDropped",4,"ngFor","ngForOf"],[1,"margins"],["type","file","id","documents","multiple","","matTooltip","Test","hidden","",1,"downloadLabel",3,"change"],["for","documents","dragndropDirective","",1,"downloadLabel",3,"fileDropped"],[1,"width250pt"],["matInput","","formControlName","urlDocument",3,"change","keydown.enter"],["mat-icon-button","","matTooltip","Add Url","color","primary",1,"material-icons","app-toolbar-menu","delete-button",3,"click","disabled"],["id","specImages",1,"gallery",3,"autoHeight","counter","thumbs","items","imageSize"],["dragndropDirective","",1,"bordervisible",3,"fileDropped"],["class","nodistance","dragndropDirective","",3,"fileDropped",4,"ngFor","ngForOf"],["type","file","id","images","multiple","","matTooltip","Test","hidden","",1,"downloadLabel",3,"change"],["for","images","dragndropDirective","",1,"downloadLabel",3,"fileDropped"],["matInput","","formControlName","urlImage",3,"change","keydown.enter"],["mat-icon-button","","matTooltip","Add Url","color","primary",1,"material-icons","app-toolbar-menu","delete-button",3,"click"],["target","_blank","rel","noopener noreferrer",1,"nodistance","clickable",3,"href"],["mat-icon-button","","class","material-icons app-toolbar-menu","matTooltip","Delete attached Document or Link","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Delete attached Document or Link","color","warn",1,"material-icons","app-toolbar-menu",3,"click"],["dragndropDirective","",1,"nodistance",3,"fileDropped"],["mat-icon-button","","class","material-icons app-toolbar-menu","matTooltip","Delete attached Document or Link","color","warn","dragndropDirective","",3,"fileDropped","click",4,"ngIf"],["mat-icon-button","","matTooltip","Delete attached Document or Link","color","warn","dragndropDirective","",1,"material-icons","app-toolbar-menu",3,"fileDropped","click"]];},template:function(i,t){if(i&1){let r=C();l(0,"form",6)(1,"button",7),d(2,"Hiden submit"),s(),l(3,"mat-accordion")(4,"mat-expansion-panel")(5,"mat-expansion-panel-header")(6,"mat-panel-title")(7,"p",8),d(8,"Documentation"),s()(),l(9,"mat-panel-description")(10,"div",9),h("fileDropped",function(m){return g(r),_(t.onDocumentationDropped(m));}),y(11,qr,2,2,"a",10)(12,Ur,1,0,"ng-template",null,0,ci),s()()(),l(14,"div",11),h("fileDropped",function(m){return g(r),_(t.onDocumentationDropped(m));}),y(15,Hr,4,3,"div",12),s(),l(16,"div",13)(17,"input",14,1),h("change",function(m){return g(r),_(t.documenationBrowseHandler(m.target));}),s(),l(19,"label",15),h("fileDropped",function(m){return g(r),_(t.onDocumentationDropped(m));}),St(20,4),s()(),l(21,"mat-form-field",16)(22,"mat-label"),d(23,"URL for Documents"),s(),l(24,"input",17),h("change",function(m){g(r);let u=ze(26);return _(t.enableAddButton(m,u));})("keydown.enter",function(){return g(r),_(t.addDocumentUrl());}),s()(),l(25,"button",18,2),h("click",function(){return g(r),_(t.addDocumentUrl());}),l(27,"mat-icon"),d(28,"add"),s()()()(),l(29,"div",13),k(30,"gallery",19),s(),l(31,"mat-accordion")(32,"mat-expansion-panel")(33,"mat-expansion-panel-header")(34,"mat-panel-title")(35,"p",8),d(36,"Modify Image List"),s()()(),l(37,"div",20),h("fileDropped",function(m){return g(r),_(t.onImageDropped(m));}),y(38,Wr,4,3,"div",21),s(),l(39,"div",13)(40,"input",22),h("change",function(m){return g(r),_(t.imageBrowseHandler(m.target));}),s(),l(41,"label",23),h("fileDropped",function(m){return g(r),_(t.onImageDropped(m));}),St(42,5),s()(),l(43,"div")(44,"mat-form-field",16)(45,"mat-label"),d(46,"Add URL for New Image"),s(),l(47,"input",24),h("change",function(m){g(r);let u=ze(49);return _(t.enableAddButton(m,u));})("keydown.enter",function(){return g(r),_(t.addImageUrl());}),s()(),l(48,"button",25,3),h("click",function(){return g(r),_(t.addImageUrl());}),l(50,"mat-icon"),d(51,"add"),s()()()()(),k(52,"div"),s();}if(i&2){let r=ze(13);p("formGroup",t.uploadFilesForm),c(7),p("ngClass",L(13,Sn,t.documentUrls.length==0)),c(4),p("ngIf",t.documentUrls.length>0)("ngIfElse",r),c(4),p("ngForOf",t.documentUrls),c(10),p("disabled",t.urlDocumentControl.value==null),c(5),p("autoHeight",!0)("counter",t.galleryItems.length>1)("thumbs",t.galleryItems.length>1)("items",t.galleryItems)("imageSize","cover"),c(5),p("ngClass",L(15,Sn,t.imageUrls.length==0)),c(3),p("ngForOf",t.imageUrls);}},dependencies:[Ai,le,ce,me,ye,Li,Cn,B,U,Se,Ce,be,z,H,Z,$,re,W,j,ie,K,oe,ae,Ui],encapsulation:2});}}return o;})();var jr=(o,n)=>n.id;function $r(o,n){if(o&1){let e=C();l(0,"button",21),h("click",function(){g(e);let t=f();return _(t.closeAndBack());}),l(1,"mat-icon"),d(2,"cancel"),s()();}}function Kr(o,n){if(o&1){let e=C();l(0,"mat-list")(1,"mat-list-item",22)(2,"a",23),h("click",function(){let t=g(e).$implicit,r=f();return _(r.jump2Message(t));}),d(3),s()()();}if(o&2){let e=n.$implicit,i=f();c(3),M(i.getValidationMessage(e));}}function Zr(o,n){o&1&&(l(0,"ul")(1,"li"),d(2," 1. The modbus timeout for the modbus controller in "),l(3,"a",25),d(4,"Busses"),s(),d(5," is too short. Increase the value. Values in the range of 300-1000 are recommended for RTU based controllers. "),s(),l(6,"li"),d(7," 2. Check the RS485 connection cable and end resistors. If the device doesn't respond, the controller will get a timeout. "),s()());}function Yr(o,n){if(o&1&&(l(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"p",22),d(4),s()()(),l(5,"p"),d(6,"Please check the following:"),s(),y(7,Zr,8,0,"ul",24),s()),o&2){let e=n.$implicit;c(4),x("Modbus error: ",e," "),c(3),p("ngIf",e=="Timed out");}}function Qr(o,n){if(o&1&&k(0,"app-entity",19),o&2){let e=n.$implicit,i=f();p("specificationMethods",i.specificationMethods)("entity",e)("disabled",i.disabled);}}var cs=(()=>{class o extends Ze{constructor(e,i,t,r,a){super(),this.entityApiService=e,this.fb=i,this.route=t,this.router=r,this.cdr=a,this.nextEmitter=new T(),this.galleryConfig={thumbs:!1},this.entitiesTouched=!1,this.saveSubject=new b(),this.i18nTouched=!1,this.filesTouched=!1,this.validationMessages=[],this.errorMessages=new Set(),this.specificationSubject=void 0,this.asyncValidateUniqueFilename=m=>{let u=new b();return m==null||m.value==null?new b().pipe(q([{invalid:m.value}]),ue()):this.originalSpecification&&m.value==this.originalSpecification.filename?new b().pipe(q(null),ue()):this.entityApiService.getSpecification(m.value).pipe(de(v=>v?{unique:v}:null),_t(()=>new b().pipe(q(null),ue())));},this.asyncValidateUniqueName=m=>{let u=new b();return m==null||m.value==null?new b().pipe(q([{invalid:m.value}]),ue()):this.originalSpecification&&m.value==this.originalSpecification.filename?new b().pipe(q(null),ue()):this.entityApiService.getSpecification(m.value).pipe(de(v=>v?{unique:v}:null),_t(()=>new b().pipe(q(null),ue())));};}ngOnDestroy(){this.currentSpecification?.filename=="_new"&&this.entityApiService.deleteNewSpecfiles().subscribe(()=>{}),this.sub&&this.sub.unsubscribe();}setCurrentSpecification(e){this.currentMessage=void 0,this.currentSpecification=e||null,this.entities=this.currentSpecification==null?void 0:this.currentSpecification.entities,this.entities&&this.currentSpecification&&Q.specificationTextsFromTranslation(this.currentSpecification,this.config.mqttdiscoverylanguage),this.specificationMethods={copy2Translation:t=>{t&&t.id>=0&&this.currentSpecification&&(Je(this.currentSpecification,this.config.mqttdiscoverylanguage,t.id,t.name),t.converterParameters&&t.converterParameters.options&&t.converterParameters.options?.forEach(r=>{Nt(this.currentSpecification,this.config.mqttdiscoverylanguage,t.id,r.key,r.name);}),this.setValidationMessages(),this.setErrorMessages(),this.specificationSubject&&this.specificationSubject.next(this.currentSpecification));},setEntitiesTouched:()=>{this.entitiesTouched=!0,this.setValidationMessages();},getMqttLanguageName:()=>Q.getLanguageName(this.config.mqttdiscoverylanguage),getUom:t=>Ii(this.currentSpecification,t),postModbusEntity:t=>{if(this.currentSpecification){let r=structuredClone(this.currentSpecification),a=structuredClone(t);Q.specificationTextsToTranslation(r,this.config.mqttdiscoverylanguage,a);let m=r.entities.findIndex(u=>u.id==a.id);return m>=0?r.entities[m]=a:r.entities.push(a),this.entityApiService.postModbusEntity(r,t,this.busId,this.slaveid,this.config.mqttdiscoverylanguage).pipe(de(u=>(this.setValidationMessages(),{id:u.id,modbusValue:u.modbusValue,mqttValue:u.mqttValue,identified:u.identified})));}else throw new Error("specification is undefined");},postModbusWriteMqtt:(t,r)=>{let a=structuredClone(this.currentSpecification),m=a.entities.findIndex(u=>u.id==t.id);return m>=0?a.entities[m]=t:a.entities.push(t),this.entityApiService.postModbusWriteMqtt(a,t.id,this.busId,this.slaveid,this.config.mqttdiscoverylanguage,r).pipe(de(u=>(this.setValidationMessages(),u)));},getNonVariableNumberEntities:()=>{let t=[];return this.currentSpecification&&this.currentSpecification.entities.forEach(r=>{if((r.variableConfiguration==null||r.variableConfiguration.targetParameter==null)&&Ee(r.converter)=="Inumber"){let a=r.name;t.push({id:r.id,name:a||""});}}),t;},getMqttNames:t=>{let r=[];return this.currentSpecification&&this.currentSpecification.entities.forEach(a=>{a.mqttname&&a.mqttname&&a.id!=t&&r.push(a.mqttname);}),r;},hasDuplicateVariableConfigurations:(t,r)=>{let a=0;switch(r){case D.deviceIdentifiers:case D.deviceSerialNumber:case D.deviceSWversion:return!1;default:return this.currentSpecification&&this.currentSpecification.entities.forEach(m=>{m.variableConfiguration!=null&&m.variableConfiguration.targetParameter!=null&&m.variableConfiguration.targetParameter==r&&m.variableConfiguration.entityId==t&&t!=r&&a++;}),a>=2;}},canEditEntity:()=>this.currentSpecification?!(this.currentSpecification.status in[0,4]):!1,addEntity:t=>{if(this.currentSpecification){this.entitiesTouched=!0;let r=1;this.currentSpecification.entities.forEach(m=>{m.id>r&&(r=m.id);}),(!this.currentSpecification.nextEntityId||r+1>this.currentSpecification.nextEntityId)&&(this.currentSpecification.nextEntityId=r+1);let a=structuredClone(t);if(a.id=this.currentSpecification.nextEntityId++,t.id>=0){let m=this.currentSpecification.entities.findIndex(v=>v.id==t.id);a.mqttname=void 0,a.name=void 0;let u=m<this.currentSpecification.entities.length?m+1:m;this.currentSpecification.entities.splice(u,0,a),this.entities=this.currentSpecification.entities;}else this.currentSpecification.entities.push(a),this.updateTranslation(a);this.setValidationMessages(),this.specificationSubject&&this.specificationSubject.next(this.currentSpecification);}},deleteEntity:t=>{if(this.currentSpecification){let r=this.currentSpecification.entities.findIndex(a=>a.id==t);r>=0&&(this.entitiesTouched=!0,this.currentSpecification.entities.splice(r,1),this.entities=this.currentSpecification.entities,wi(this.currentSpecification,t)),this.setValidationMessages(),this.specificationSubject&&this.specificationSubject.next(this.currentSpecification);}},getSaveObservable:()=>this.saveSubject,getCurrentMessage:()=>this.currentMessage},this.originalSpecification=structuredClone(e),this.entitiesTouched=!1,this.filesTouched=!1,this.i18nTouched=!1,this.specificationSubject&&this.specificationSubject.next(this.currentSpecification);let i=null;this.currentSpecification&&this.currentSpecification.filename&&this.currentSpecification.filename!="_new"&&(i=this.currentSpecification.filename),this.enterSpecNameFormGroup.get("name")?.setValue(this.currentSpecification?Qe(this.currentSpecification,this.config.mqttdiscoverylanguage,!0):null),this.enterSpecNameFormGroup.get("filename")?.setValue(i),this.enterSpecNameFormGroup.get("model")?.setValue(this.currentSpecification&&this.currentSpecification.model?this.currentSpecification.model:null),this.enterSpecNameFormGroup.get("manufacturer")?.setValue(this.currentSpecification&&this.currentSpecification.manufacturer?this.currentSpecification.manufacturer:null),this.enterSpecNameFormGroup.markAsPristine(),this.setValidationMessages();}setFilename(){let e=Ge(this.enterSpecNameFormGroup.get("name")?.value),i=this.enterSpecNameFormGroup.get("filename");this.currentSpecification&&[2,3].indexOf(this.currentSpecification.status)>=0&&i&&(i.value==null||i.value.length==0)&&i.patchValue(e);}copyToSpec(){this.currentSpecification||(this.currentSpecification={filename:"",files:[],entities:[],i18n:[],identified:ee.unknown,status:3}),this.enterSpecNameFormGroup.valid&&(this.currentSpecification.filename=this.enterSpecNameFormGroup.get("filename")?.value,this.currentSpecification.model=this.enterSpecNameFormGroup.get("model")?.value!=null?this.enterSpecNameFormGroup.get("model")?.value:void 0,this.currentSpecification.manufacturer=this.enterSpecNameFormGroup.get("manufacturer")?.value!=null?this.enterSpecNameFormGroup.get("manufacturer")?.value:void 0,xi(this.currentSpecification,this.config.mqttdiscoverylanguage,this.enterSpecNameFormGroup.get("name").value)),this.setValidationMessages();let e=structuredClone(this.currentSpecification.entities);Q.specificationTextsToTranslation(this.currentSpecification,this.config.mqttdiscoverylanguage),this.currentSpecification.entities=e,this.entities=e,this.specificationSubject&&this.specificationSubject.next(this.currentSpecification);}getTranslatedSpecName(){return this.config&&this.config.mqttdiscoverylanguage&&this.currentSpecification?Qe(this.currentSpecification,this.config.mqttdiscoverylanguage,!0):null;}updateDocuments(e){!e||!this.currentSpecification||(this.currentSpecification.files=e,this.filesTouched=!0,this.setValidationMessages());}updateTranslation(e){e&&this.currentSpecification&&(e.name&&Je(this.currentSpecification,this.config.mqttdiscoverylanguage,e.id,e.name),e.converterParameters&&e.converterParameters.options&&e.converterParameters.options?.forEach(i=>{Nt(this.currentSpecification,this.config.mqttdiscoverylanguage,e.id,i.key,i.name);}));}updateI18n(e){if(!(!e||!this.currentSpecification)){if(Q.updateSpecificationI18n(e.key,this.currentSpecification,this.config.mqttdiscoverylanguage),e.key=="name"){let i=Qe(this.currentSpecification,this.config.mqttdiscoverylanguage,!0);i&&this.enterSpecNameFormGroup.get("name").setValue(i);}this.setValidationMessages(),this.i18nTouched=!0;}}saveSpecification(e=!1){if(this.slaveid!=null&&this.busId!=null&&this.currentSpecification&&this.entities&&this.validateSpecification(this.currentSpecification)){let i=structuredClone(this.entities);i.forEach(t=>{t.name&&Je(this.currentSpecification,this.config.mqttdiscoverylanguage,t.id,t.name),delete t.name;}),this.currentSpecification.entities=i,Q.specificationTextsToTranslation(this.currentSpecification,this.config.mqttdiscoverylanguage),this.entityApiService.postSpecification(this.currentSpecification,this.busId,this.slaveid,this.originalSpecification?this.originalSpecification.filename:null).subscribe(t=>{this.entityApiService.getModbusSpecification(this.busId,this.slaveid,t.filename).subscribe(r=>{this.setCurrentSpecification(r),this.entitiesTouched=!1,this.filesTouched=!1,this.i18nTouched=!1,this.enterSpecNameFormGroup.markAsPristine(),this.saveSubject.next(),e&&this.closeAndBack();});});}}saveSpecificationAndBack(){this.saveSpecification(!0);}closeAndBack(){this.router.navigate(["/slaves",this.busId]);}getFilenane(){return this.currentSpecification?this.currentSpecification.filename:"";}getFiles(){return this.currentSpecification?this.currentSpecification.files:[];}getEntities(){return this.currentSpecification?this.currentSpecification.entities:[];}drop(e){this.entities&&e&&(De(this.entities,e.previousIndex,e.currentIndex),this.entitiesTouched=!0);}getSpecification(){return this.currentSpecification;}validateSpecification(e,i=void 0){return i?i=[]:i=[],(!e.filename||e.filename.length==0)&&i.push("No filename for specification"),(!e.entities||e.entities.length==0)&&i.push("No entity in specification"),(!e.files||e.files.length==0)&&i.push("No files in specification"),(!e.i18n||e.i18n.length==0)&&i.push("No translations in specification"),i.length==0;}ngOnInit(){this.enterSpecNameFormGroup=this.fb.group({name:[null,w.required],filename:[null],icon:[null],manufacturer:[null],model:[null]}),this.validationForms=this.fb.group({spec:this.enterSpecNameFormGroup}),this.entityApiService.getConfiguration().subscribe(e=>{this.config=e,this.specServices=new ot(this.config.mqttdiscoverylanguage,this.entityApiService),this.sub=this.route.params.subscribe(i=>{this.busId=+i.busid,this.slaveid=+i.slaveid,this.disabled=i.disabled!="false",this.entityApiService.getSlave(this.busId,this.slaveid).subscribe(t=>{t.specificationid?this.entityApiService.getSpecification(t.specificationid).subscribe(r=>{this.setCurrentSpecification(r),this.entityApiService.getModbusSpecification(this.busId,this.slaveid,t.specificationid).subscribe(this.setCurrentSpecification.bind(this));}):this.setCurrentSpecification(structuredClone(Ti));});});});}getValidationMessage(e){return this.specServices?this.specServices.getValidationMessage(this.currentSpecification,e):"unknown message";}setValidationMessages(){this.currentSpecification&&this.entityApiService.postForSpecificationValidation(this.currentSpecification,this.config.mqttdiscoverylanguage).subscribe(e=>{this.validationMessages=e;});}setErrorMessages(){this.errorMessages=new Set(),this.currentSpecification?.entities.forEach(e=>{e.modbusError&&this.errorMessages.add(e.modbusError);});}getErrorMessageHint(e){switch(e){case"Timed out":return"Please check the timeout in";}return"";}isValid(){return this.currentSpecification?this.validationForms.valid:!1;}jump2Message(e){this.currentMessage=e;}isTouched(){return this.entitiesTouched||this.i18nTouched||!this.enterSpecNameFormGroup.pristine;}canDeactivate(){return this.isTouched()&&!this.router.url.includes("tokenWasExpired")?!window.confirm("There are unsaved changes! Are you sure?"):!1;}getUrlTitle(e){return Fi(e.url);}getStatusIcon(e){return ot.getStatusIcon(e);}getStatusText(e){return ot.getStatusText(e);}static{this.ɵfac=function(i){return new(i||o)(F(te),F(se),F(di),F(We),F(Me));};}static{this.ɵcmp=G({type:o,selectors:[["app-specification"]],hostBindings:function(i,t){i&1&&h("beforeunload",function(a){return t.canDeactivate(a);},!1,ti);},outputs:{nextEmitter:"nextEmitter"},features:[He],decls:47,vars:16,consts:[[1,"saveCancel"],["mat-icon-button","","matTooltip","Save Changes","color","primary",1,"material-icons","app-toolbar-menu","save-button",3,"click","disabled"],["mat-icon-button","","class","material-icons app-toolbar-menu cancel-button","matTooltip","Cancel Changes","color","warn",3,"click",4,"ngIf"],[1,"flexrowsWrapWhenSmall"],[1,"card","flex-align"],[3,"matTooltip"],[1,"messages"],[4,"ngFor","ngForOf"],[1,"margins"],[3,"updateDocumentation","specification"],["id","specForm",1,"flexcolumns",3,"formGroup"],[1,"width250pt"],["matInput","","formControlName","name",3,"change"],[1,"flexcolumns"],["matInput","","formControlName","filename",3,"change"],["matInput","","formControlName","manufacturer",3,"change"],["matInput","","formControlName","model",3,"change"],[3,"updateI18n","specificationObservable","specificationMethods","specificationFormGroup","mqttdiscoverylanguage"],[1,"flexrows","flex-auto"],[3,"specificationMethods","entity","disabled"],[3,"specificationMethods","disabled"],["mat-icon-button","","matTooltip","Cancel Changes","color","warn",1,"material-icons","app-toolbar-menu","cancel-button",3,"click"],[1,"message"],[1,"message",3,"click","routerLink"],[4,"ngIf"],["routerLink","/busses"]],template:function(i,t){i&1&&(l(0,"div",0)(1,"button",1),h("click",function(){return t.saveSpecification();}),l(2,"mat-icon"),d(3,"check_circle"),s()(),y(4,$r,3,0,"button",2),s(),l(5,"div",3)(6,"mat-card",4)(7,"mat-card-header")(8,"mat-card-title")(9,"mat-icon",5),d(10),s(),d(11),s()(),l(12,"mat-card-content")(13,"p",6),y(14,Kr,4,1,"mat-list",7),s(),l(15,"p"),y(16,Yr,8,2,"mat-expansion-panel",7),s(),l(17,"div",8)(18,"app-upload-files",9),h("updateDocumentation",function(a){return t.updateDocuments(a);}),s()(),l(19,"form",10)(20,"mat-form-field",11)(21,"mat-label"),d(22),s(),l(23,"input",12),h("change",function(){return t.setFilename(),t.copyToSpec();}),s()(),l(24,"mat-expansion-panel")(25,"mat-expansion-panel-header")(26,"mat-panel-title"),d(27," Discovery Details "),s()(),l(28,"div",13)(29,"mat-form-field",11)(30,"mat-label"),d(31,"Specification File Name"),s(),l(32,"input",14),h("change",function(){return t.copyToSpec();}),s()(),l(33,"mat-form-field",11)(34,"mat-label"),d(35,"Manufacturer"),s(),l(36,"input",15),h("change",function(){return t.copyToSpec();}),s()(),l(37,"mat-form-field",11)(38,"mat-label"),d(39,"Model"),s(),l(40,"input",16),h("change",function(){return t.copyToSpec();}),s()()()()(),l(41,"app-translation",17),h("updateI18n",function(a){return t.updateI18n(a);}),s()()(),l(42,"div")(43,"div",18),oi(44,Qr,1,3,"app-entity",19,jr),k(46,"app-entity",20),s()()()),i&2&&(c(),p("disabled",!t.isTouched()||!t.isValid()),c(3),p("ngIf",t.currentSpecification!=null),c(5),p("matTooltip",t.getStatusText(t.currentSpecification==null?null:t.currentSpecification.status)),c(),M(t.getStatusIcon(t.currentSpecification==null?null:t.currentSpecification.status)),c(),M(t.getTranslatedSpecName()),c(3),p("ngForOf",t.validationMessages),c(2),p("ngForOf",t.errorMessages),c(2),p("specification",t.currentSpecification),c(),p("formGroup",t.enterSpecNameFormGroup),c(3),x("Specification Name(",t.specificationMethods?t.specificationMethods.getMqttLanguageName():"",")"),c(19),p("specificationObservable",t.specificationSubject)("specificationMethods",t.specificationMethods)("specificationFormGroup",t.validationForms)("mqttdiscoverylanguage",t.config?t.config.mqttdiscoverylanguage:""),c(3),ai(t.currentSpecification==null?null:t.currentSpecification.entities),c(2),p("specificationMethods",t.specificationMethods)("disabled",t.disabled));},dependencies:[Se,Ce,be,B,et,nt,tt,it,U,Ri,Gi,ui,le,ce,me,En,$,re,W,j,ie,K,oe,ae,z,H,Z,bn,yn],styles:[`.mat-mdc-card-header{font-weight:700;background-color:#ebdffa;display:flex}.messages{right:0;margin-left:auto}.message{color:red;cursor:pointer}
`],encapsulation:2});}}return o;})();export{cs as SpecificationComponent};/**i18n:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855*/